<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>js原生api | amos-love-frontend</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/img/logo.jpg">
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.eb89045f.css" as="style"><link rel="preload" href="/assets/js/app.06410148.js" as="script"><link rel="preload" href="/assets/js/2.493bf590.js" as="script"><link rel="preload" href="/assets/js/49.84061ec5.js" as="script"><link rel="prefetch" href="/assets/js/10.22690350.js"><link rel="prefetch" href="/assets/js/11.158f0201.js"><link rel="prefetch" href="/assets/js/12.1e8c7e0c.js"><link rel="prefetch" href="/assets/js/13.79ea1323.js"><link rel="prefetch" href="/assets/js/14.09f6da95.js"><link rel="prefetch" href="/assets/js/15.5be75f96.js"><link rel="prefetch" href="/assets/js/16.3b423e4f.js"><link rel="prefetch" href="/assets/js/17.58f5921b.js"><link rel="prefetch" href="/assets/js/18.ea8f7176.js"><link rel="prefetch" href="/assets/js/19.6f1622f8.js"><link rel="prefetch" href="/assets/js/20.16ae2fc6.js"><link rel="prefetch" href="/assets/js/21.e6d6402e.js"><link rel="prefetch" href="/assets/js/22.2666be97.js"><link rel="prefetch" href="/assets/js/23.ef81e74b.js"><link rel="prefetch" href="/assets/js/24.d6c9dd1d.js"><link rel="prefetch" href="/assets/js/25.284ae095.js"><link rel="prefetch" href="/assets/js/26.47589fff.js"><link rel="prefetch" href="/assets/js/27.e95e28a0.js"><link rel="prefetch" href="/assets/js/28.154c2196.js"><link rel="prefetch" href="/assets/js/29.b6378d1d.js"><link rel="prefetch" href="/assets/js/3.7238a580.js"><link rel="prefetch" href="/assets/js/30.4ed5c424.js"><link rel="prefetch" href="/assets/js/31.d55b7a0e.js"><link rel="prefetch" href="/assets/js/32.2e5d3521.js"><link rel="prefetch" href="/assets/js/33.aa6b3f18.js"><link rel="prefetch" href="/assets/js/34.bdcd2820.js"><link rel="prefetch" href="/assets/js/35.333509f5.js"><link rel="prefetch" href="/assets/js/36.185ab4eb.js"><link rel="prefetch" href="/assets/js/37.e14dcaa2.js"><link rel="prefetch" href="/assets/js/38.881202f5.js"><link rel="prefetch" href="/assets/js/39.78c82b10.js"><link rel="prefetch" href="/assets/js/4.cb683e36.js"><link rel="prefetch" href="/assets/js/40.ba5dbb68.js"><link rel="prefetch" href="/assets/js/41.2ff3e7c9.js"><link rel="prefetch" href="/assets/js/42.984e6b03.js"><link rel="prefetch" href="/assets/js/43.ff7e81bd.js"><link rel="prefetch" href="/assets/js/44.a72ff238.js"><link rel="prefetch" href="/assets/js/45.48544888.js"><link rel="prefetch" href="/assets/js/46.7c4db854.js"><link rel="prefetch" href="/assets/js/47.de9732b3.js"><link rel="prefetch" href="/assets/js/48.44a1b7a6.js"><link rel="prefetch" href="/assets/js/5.1d54831f.js"><link rel="prefetch" href="/assets/js/50.532d2859.js"><link rel="prefetch" href="/assets/js/51.62157c55.js"><link rel="prefetch" href="/assets/js/52.ad22580e.js"><link rel="prefetch" href="/assets/js/53.504cc85c.js"><link rel="prefetch" href="/assets/js/54.aa6a57e0.js"><link rel="prefetch" href="/assets/js/55.70a0d3f5.js"><link rel="prefetch" href="/assets/js/56.eee2dc8d.js"><link rel="prefetch" href="/assets/js/57.8a29c526.js"><link rel="prefetch" href="/assets/js/58.2e28beee.js"><link rel="prefetch" href="/assets/js/59.3544e2ed.js"><link rel="prefetch" href="/assets/js/6.3b82bf4f.js"><link rel="prefetch" href="/assets/js/60.a16bd2fe.js"><link rel="prefetch" href="/assets/js/61.16368477.js"><link rel="prefetch" href="/assets/js/62.41a66c3d.js"><link rel="prefetch" href="/assets/js/63.462a2710.js"><link rel="prefetch" href="/assets/js/64.2e1d89b9.js"><link rel="prefetch" href="/assets/js/65.bd1e8ea7.js"><link rel="prefetch" href="/assets/js/66.61657fe2.js"><link rel="prefetch" href="/assets/js/67.e7e28166.js"><link rel="prefetch" href="/assets/js/68.621c18ff.js"><link rel="prefetch" href="/assets/js/69.1117ee32.js"><link rel="prefetch" href="/assets/js/7.a90060b5.js"><link rel="prefetch" href="/assets/js/70.b46c859e.js"><link rel="prefetch" href="/assets/js/71.78e955bf.js"><link rel="prefetch" href="/assets/js/72.faa75169.js"><link rel="prefetch" href="/assets/js/73.5e2f088b.js"><link rel="prefetch" href="/assets/js/74.2d39fd83.js"><link rel="prefetch" href="/assets/js/75.09dc3cad.js"><link rel="prefetch" href="/assets/js/76.87a2326b.js"><link rel="prefetch" href="/assets/js/77.da8507b7.js"><link rel="prefetch" href="/assets/js/78.8edf7a4e.js"><link rel="prefetch" href="/assets/js/79.c88d23f1.js"><link rel="prefetch" href="/assets/js/8.face0b18.js"><link rel="prefetch" href="/assets/js/80.7eb35acd.js"><link rel="prefetch" href="/assets/js/81.14d1a75f.js"><link rel="prefetch" href="/assets/js/82.2fcf484b.js"><link rel="prefetch" href="/assets/js/83.0bed0a5e.js"><link rel="prefetch" href="/assets/js/84.53a7a1f4.js"><link rel="prefetch" href="/assets/js/85.b45b0537.js"><link rel="prefetch" href="/assets/js/86.23a6532b.js"><link rel="prefetch" href="/assets/js/87.d0cafe4a.js"><link rel="prefetch" href="/assets/js/88.e5bd709e.js"><link rel="prefetch" href="/assets/js/89.601569d6.js"><link rel="prefetch" href="/assets/js/9.87d9bcc7.js"><link rel="prefetch" href="/assets/js/90.1d035a68.js"><link rel="prefetch" href="/assets/js/91.a2a5aba5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.eb89045f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.jpg" alt="amos-love-frontend" class="logo"> <span class="site-name can-hide">amos-love-frontend</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/html/" class="nav-link">
  Notes
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/html/" class="nav-link">
  Notes
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/guide/" class="sidebar-link">导读</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/html/" class="sidebar-heading clickable"><span>HTML</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group depth-0"><a href="/css/" class="sidebar-heading clickable"><span>CSS</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/css/base/" class="sidebar-heading clickable open"><span>base</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/css/base/dimensions/" class="sidebar-link">dimensions</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/css/font/" class="sidebar-heading clickable"><span>font</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/css/sass/" class="sidebar-heading clickable"><span>sass</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/css/less/" class="sidebar-heading clickable"><span>less</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/css/css_module/" class="sidebar-link">css module</a></li><li><a href="/css/css_fn/" class="sidebar-link">css fn</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/js/" class="sidebar-heading clickable router-link-active open"><span>JS</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><a href="/js/base/" class="sidebar-heading clickable router-link-active open"><span>js</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/js/base/data_type/" class="sidebar-link">date type</a></li><li><a href="/js/base/object/" class="sidebar-link">object</a></li><li><a href="/js/base/array/" class="sidebar-link">array</a></li><li><a href="/js/base/string/" class="sidebar-link">string</a></li><li><a href="/js/base/class/" class="sidebar-link">class</a></li><li><a href="/js/base/set/" class="sidebar-link">set</a></li><li><a href="/js/base/base_api/" aria-current="page" class="active sidebar-link">base api</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/base/base_api/#js原生api" class="sidebar-link">js原生api</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/base/base_api/#math对象" class="sidebar-link">Math对象</a></li><li class="sidebar-sub-header"><a href="/js/base/base_api/#date" class="sidebar-link">Date</a></li><li class="sidebar-sub-header"><a href="/js/base/base_api/#localstorage-sessionstorage-cookie-对比" class="sidebar-link">localStorage sessionStorage cookie 对比</a></li><li class="sidebar-sub-header"><a href="/js/base/base_api/#localstorage" class="sidebar-link">localStorage</a></li><li class="sidebar-sub-header"><a href="/js/base/base_api/#localhost" class="sidebar-link">localhost</a></li><li class="sidebar-sub-header"><a href="/js/base/base_api/#switch" class="sidebar-link">switch</a></li><li class="sidebar-sub-header"><a href="/js/base/base_api/#new-function" class="sidebar-link">new Function</a></li><li class="sidebar-sub-header"><a href="/js/base/base_api/#function" class="sidebar-link">function</a></li><li class="sidebar-sub-header"><a href="/js/base/base_api/#函数声明提升优先" class="sidebar-link">函数声明提升优先</a></li><li class="sidebar-sub-header"><a href="/js/base/base_api/#函数声明" class="sidebar-link">函数声明</a></li><li class="sidebar-sub-header"><a href="/js/base/base_api/#eval" class="sidebar-link">eval</a></li><li class="sidebar-sub-header"><a href="/js/base/base_api/#async-await" class="sidebar-link">async await</a></li><li class="sidebar-sub-header"><a href="/js/base/base_api/#async-await-遍历方法-结合的问题" class="sidebar-link">async await 遍历方法 结合的问题</a></li><li class="sidebar-sub-header"><a href="/js/base/base_api/#for" class="sidebar-link">for</a></li><li class="sidebar-sub-header"><a href="/js/base/base_api/#await-无限等待" class="sidebar-link">await 无限等待</a></li><li class="sidebar-sub-header"><a href="/js/base/base_api/#console" class="sidebar-link">console</a></li><li class="sidebar-sub-header"><a href="/js/base/base_api/#打印dom信息" class="sidebar-link">打印dom信息</a></li><li class="sidebar-sub-header"><a href="/js/base/base_api/#打印对象" class="sidebar-link">打印对象</a></li></ul></li></ul></li><li><a href="/js/base/request/" class="sidebar-link">request</a></li><li><a href="/js/base/coding/" class="sidebar-link">coding</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/js/dom/" class="sidebar-heading clickable"><span>dom</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/js/dom/input/" class="sidebar-link">input</a></li><li><a href="/js/dom/window/" class="sidebar-link">window</a></li><li><a href="/js/dom/video/" class="sidebar-link">video</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/js/function_collection/" class="sidebar-heading clickable"><span>function collection</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/js/function_collection/input/" class="sidebar-link">input</a></li><li><a href="/js/function_collection/date/" class="sidebar-link">date</a></li></ul></section></li><li><a href="/js/code_style/" class="sidebar-link">code style</a></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/js/ts/" class="sidebar-heading clickable"><span>ts</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/js/ts/base_learning/" class="sidebar-link">base learning</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/react/" class="sidebar-heading clickable"><span>react</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/react/base/" class="sidebar-heading clickable open"><span>base</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/react/base/api/" class="sidebar-link">api</a></li><li><a href="/react/base/fn/" class="sidebar-link">fn</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/react/source_code/" class="sidebar-heading clickable"><span>source code</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/react/project_learning/" class="sidebar-heading clickable"><span>project learning</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/react/third_party/" class="sidebar-link">third party</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/engineering/" class="sidebar-heading clickable"><span>engineering</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/engineering/npm/" class="sidebar-link">npm</a></li><li><a href="/engineering/webpack/" class="sidebar-link">webpack</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/engineering/git/" class="sidebar-heading clickable"><span>git</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/third_party/" class="sidebar-heading clickable"><span>third party</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/third_party/echart/" class="sidebar-link">EChart</a></li><li><a href="/third_party/jquery/" class="sidebar-link">jquery</a></li></ul></section></li><li><a href="/markdown/" class="sidebar-link">MARKDOWN</a></li><li><section class="sidebar-group depth-0"><a href="/linux/" class="sidebar-heading clickable"><span>linux</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/linux/base/" class="sidebar-link">linux base</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/editor/" class="sidebar-heading clickable"><span>editor</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/editor/webstorm/" class="sidebar-link">webstorm</a></li><li><a href="/editor/vscode/" class="sidebar-link">vscode</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/interview/" class="sidebar-heading clickable"><span>面试需背（你懂的）</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/base/" class="sidebar-link">基础</a></li><li><a href="/interview/question/" class="sidebar-link">question</a></li></ul></section></li><li><a href="/other/" class="sidebar-link">其他未分类</a></li><li><a href="/en/" class="sidebar-link">EN</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="js原生api"><a href="#js原生api" class="header-anchor">#</a> js原生api</h2> <h3 id="math对象"><a href="#math对象" class="header-anchor">#</a> Math对象</h3> <div class="language-js extra-class"><pre class="language-js"><code>Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token number">3.6</span><span class="token punctuation">)</span> <span class="token comment">//4 四舍五入</span>

Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//var x = Math.random() 产生一个0-1的小数，包含0，不包含1</span>

Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>num1<span class="token punctuation">,</span> num2<span class="token punctuation">)</span> <span class="token comment">//返回交大数</span>

Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>num1<span class="token punctuation">,</span> num2<span class="token punctuation">)</span> <span class="token comment">//返回交小数</span>

Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token comment">//绝对值</span>

Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//向上取整</span>

Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//向下取整</span>

Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token comment">//x的y次方</span>

Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token comment">//开平方</span>
</code></pre></div><h3 id="date"><a href="#date" class="header-anchor">#</a> Date</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 新建时间对象的方法。不设定参数时，为计算机当时的时间。</span>

<span class="token keyword">let</span> date1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">2006</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">35</span><span class="token punctuation">)</span> <span class="token comment">// 参数形式 ：YYYY,M,D,H,M,S</span>

<span class="token keyword">let</span> date2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">2003</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token comment">// 年月日</span>

<span class="token keyword">let</span> date3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">2325545454</span><span class="token punctuation">)</span> <span class="token comment">// 毫秒数</span>

<span class="token comment">// 获取/设置年月日</span>

date<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
date<span class="token punctuation">.</span><span class="token function">setFullYear</span><span class="token punctuation">(</span><span class="token number">2014</span><span class="token punctuation">)</span>

date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
date<span class="token punctuation">.</span><span class="token function">setMonth</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token comment">// 值从0-11，0指1月</span>

date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
date<span class="token punctuation">.</span><span class="token function">setDate</span><span class="token punctuation">(</span><span class="token number">29</span><span class="token punctuation">)</span>

date<span class="token punctuation">.</span><span class="token function">getDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 得到星期，星期无法写入，值0-6，0是星期天</span>

date<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
date<span class="token punctuation">.</span><span class="token function">setHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 值0-23</span>

date<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
date<span class="token punctuation">.</span><span class="token function">setMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 值0-59</span>

date<span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
date<span class="token punctuation">.</span><span class="token function">setSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 值0-59</span>

date<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
date<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 单位：毫秒数</span>
</code></pre></div><h3 id="localstorage-sessionstorage-cookie-对比"><a href="#localstorage-sessionstorage-cookie-对比" class="header-anchor">#</a> localStorage sessionStorage cookie 对比</h3> <table><thead><tr><th style="text-align:center;">对比</th> <th style="text-align:center;">localStorage</th> <th style="text-align:center;">sessionStorage</th> <th style="text-align:center;">cookie</th></tr></thead> <tbody><tr><td style="text-align:center;"><strong>失效</strong></td> <td style="text-align:center;">关浏览器不会丢失</td> <td style="text-align:center;">关闭浏览器窗口数据销毁</td> <td style="text-align:center;">关浏览器不会丢失，可设置过期时间</td></tr> <tr><td style="text-align:center;"><strong>大小</strong></td> <td style="text-align:center;">5MB</td> <td style="text-align:center;">5MB</td> <td style="text-align:center;">4KB</td></tr> <tr><td style="text-align:center;"><strong>共享</strong></td> <td style="text-align:center;">同域名共享数据，浏览器不同窗口实时同步共享</td> <td style="text-align:center;">新建立的页面不会共享session数据，同一浏览器已经开的相同的2个页面之间也不会共享。<br>通过当前页面跳转的会共享数据，比如window.open，但是之后两个页面的session数据是相互独立的</td> <td style="text-align:center;">同域名共享数据，浏览器不同窗口实时同步共享</td></tr> <tr><td style="text-align:center;"><strong>请求</strong></td> <td style="text-align:center;">请求不会自动附上</td> <td style="text-align:center;">请求不会自动附上</td> <td style="text-align:center;">请求会自动附上， 因此会浪费一部分带宽</td></tr></tbody></table> <h3 id="localstorage"><a href="#localstorage" class="header-anchor">#</a> localStorage</h3> <p>基本方法：</p> <ol><li>存储：localStorage.setItem(key,value)</li></ol> <p>通过键名写入键值，如果key存在时，更新value</p> <ol start="2"><li>获取：localStorage.getItem(key)</li></ol> <p>通过键名获得键值，如果key不存在返回null</p> <ol start="3"><li>删除：localStorage.removeItem(key)</li></ol> <p>通过键名删除键值对，一旦删除，键名和值将会全部删除</p> <ol start="4"><li>全部清除：localStorage.clear()</li></ol> <p>清除所有localStorage对象保存的数据</p> <ol start="5"><li>遍历localStorage存储的key</li></ol> <p>数据总数：localStorage.length</p> <p>localStorage.key(index) 获取key</p> <ol start="6"><li>不能直接保存对象，存储JSON格式数据或对象需要转字符串</li></ol> <p>JSON.stringify(data) 将一个对象转换成数据串</p> <p>JSON.parse(data) 将数据解析成对象</p> <ol start="7"><li>遍历</li></ol> <p>迭代，localStorage（sessionStorage）是一个对象，它包含存储的内容键值对，最后还有一个length:长度，
用自身循环方法key迭代时，不会迭代出长度属性。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> localStorage<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">let</span> key <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment">//遍历键值，这里设计的方法比较特别，</span>
   <span class="token comment">// 相当于序号，键名，键值3个内容互相绑定。 这里通过序号遍历键名</span>
   
   console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// key  val</span>
<span class="token punctuation">}</span>
</code></pre></div><p>无法用for of迭代</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span>key <span class="token keyword">of</span> localStorage<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// localStorage is not iterable </span>
  <span class="token comment">// localStorage和sessionStorage无法枚举</span>
   
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'key:'</span><span class="token punctuation">,</span>key<span class="token punctuation">,</span><span class="token string">'localStorage[key]'</span><span class="token punctuation">,</span>localStorage<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="localhost"><a href="#localhost" class="header-anchor">#</a> localhost</h3> <p>127.0.0.1 等同于 localhost</p> <h3 id="switch"><a href="#switch" class="header-anchor">#</a> switch</h3> <p>条件是 === 比较</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 其中case是全等才走</span>
<span class="token keyword">let</span> str
<span class="token keyword">switch</span> <span class="token punctuation">(</span>level<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">case</span> <span class="token string">'a'</span><span class="token operator">:</span> <span class="token comment">// 不写break穿透合并，即a 会执行后面A的语句</span>

   <span class="token keyword">case</span> <span class="token string">'A'</span><span class="token operator">:</span>
      str <span class="token operator">=</span> <span class="token string">'您的成绩是85-100之间'</span>
      <span class="token keyword">break</span>
   <span class="token keyword">case</span> <span class="token string">'b'</span><span class="token operator">:</span>

   <span class="token keyword">case</span> <span class="token string">'B'</span><span class="token operator">:</span>
      str <span class="token operator">=</span> <span class="token string">'您的成绩是60-84之间'</span>
      <span class="token keyword">break</span>
   <span class="token keyword">case</span> <span class="token string">'c'</span><span class="token operator">:</span>

   <span class="token keyword">case</span> <span class="token string">'C'</span><span class="token operator">:</span>
      str <span class="token operator">=</span> <span class="token string">'您挂科了'</span>
      <span class="token keyword">break</span>
   <span class="token keyword">default</span><span class="token operator">:</span>
      str <span class="token operator">=</span> <span class="token string">'数据错误'</span>
      <span class="token keyword">break</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="new-function"><a href="#new-function" class="header-anchor">#</a> new Function</h3> <p>eval 和 newFunction 都可以把一个字符串当成一段代码执行 //很少有var a = new Function(param,body);// 并且body里面只能是string类型.
这两种放在现版本chrome浏览器控制台会报安全性错误，不让运行。edge的控制台可以运行</p> <p>new Function:
new Function(param,string) // param入参。string运行的代码字符串，必须是string类型</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">'console.log(`Hello ${name}!`)'</span>
<span class="token keyword">let</span> func <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">func</span><span class="token punctuation">(</span><span class="token string">'Jack'</span><span class="token punctuation">)</span> <span class="token comment">// &quot;Hello Jack!&quot;</span>
</code></pre></div><h3 id="function"><a href="#function" class="header-anchor">#</a> function</h3> <p>如果function是整个声明语句的第一个词，就是函数声明， 否则，function就是函数表达式（表达式结果是个值，不是声明）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">a</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// function是声明，会提升至作用域最上面</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// a</span>

  <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">b</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// function是表达式</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 报错，Uncaught ReferenceError: b is not defined</span>
</code></pre></div><p>表达式不会声明变量，表达式结果是个值</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">c</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// function是表达式，表达式方式声明函数，申明不会提升</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// c</span>
</code></pre></div><h3 id="函数声明提升优先"><a href="#函数声明提升优先" class="header-anchor">#</a> 函数声明提升优先</h3> <p>函数声明整体首先会被提升，然后才是普通变量声明的提升（普通变量只是声明提升，赋值及其他逻辑均留在原处）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
<span class="token keyword">var</span> foo
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>引擎理解成如下形式：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> foo <span class="token comment">// 尽管普通变量声明提升在后面，但是普通变量声明只有声明被提升，赋值在原地，</span>
<span class="token comment">// 然后重复声明并没有把前面值覆盖，而是忽略了重复声明。</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
<span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="函数声明"><a href="#函数声明" class="header-anchor">#</a> 函数声明</h3> <p>尽可能避免把函数声明放在判断条件中，因为js未来版本中解析规则可能会发生变化
(当chrome前版本84，已经将function解析在内部了，无法提升，打印Uncaught TypeError: foo is not a function)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// b // 84版chrome打印Uncaught TypeError: foo is not a function</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
   <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// a</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">{</span>
   <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// Uncaught TypeError: foo is not a function</span>
</code></pre></div><h3 id="eval"><a href="#eval" class="header-anchor">#</a> eval</h3> <p>eval: 非严格模式下，用var定义变量，会在词法作用于中插入变量b的声明定义（工作原理）， 从而改变了浏览器编译时的词法作用域。 （浏览器会通过词法静态分析优化变量和函数。如果eval存在，会动态改变词法作用域，
浏览器只能选择不做优化避免引起程序逻辑变化。所以会影响性能。）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token number">2</span>

<span class="token keyword">function</span> <span class="token function">org</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">eval</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">org</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'var b = 3'</span><span class="token punctuation">)</span> <span class="token comment">// 1 3</span>
<span class="token function">org</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'let b = 3'</span><span class="token punctuation">)</span> <span class="token comment">// 1 2</span>

<span class="token keyword">function</span> <span class="token function">fn</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> b <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">org</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">let b = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>b<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token comment">// 1 2</span>
  <span class="token function">org</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">var b = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>b<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token comment">// 1 0.32133</span>
<span class="token punctuation">}</span>

<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="async-await"><a href="#async-await" class="header-anchor">#</a> async await</h3> <p><strong>async后面的函数需要return一个promise，否则，如果返回一个undefined， 会被包装成new Promise((resolve)=&gt;resolve(undefined))
await等的promise不是真正要等的那个setTimeout了，所以等到得到undefined后就往下执行了， 不等想要等的setTimeout了。</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">wait1s</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 将需要等待的setTimeout的promise返回了</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'i:'</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> iR <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">wait1s</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// await会正确等待setTimeout的promise</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'iR:'</span><span class="token punctuation">,</span> iR<span class="token punctuation">)</span>
</code></pre></div><p>返回一个undefined，await一个undefined不会等</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">wait1s</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 没写返回，默认返回一个undefined，被包装成promise。 </span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'i:'</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token comment">// 三秒后打印 i:1</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> iR <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">wait1s</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// await没有等待setTimeout的promise，等到undefined后就往下执行了</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'iR:'</span><span class="token punctuation">,</span> iR<span class="token punctuation">)</span> <span class="token comment">// 0秒打印 iR: undefined</span>
</code></pre></div><h3 id="async-await-遍历方法-结合的问题"><a href="#async-await-遍历方法-结合的问题" class="header-anchor">#</a> async await 遍历方法 结合的问题</h3> <p>async await放在遍历方法（map、reduce、reduceRight、forEach、filter、some、every）中，会失效 （即遍历过程，不会等待一个结束之后再遍历下一个，并且遍历还可能会出错，得到乱七八糟的结果）。</p> <p>（方案1.考虑是否可以把异步逻辑从遍历中抽出来，不用async await，方案2.按照下面讨论的思路进行处理）。</p> <p>个人碰到的问题：</p> <p>理想中是，按照顺序拿到1st，2nd，3rd，4th的值。然后在循环结束的下面语句，拿到处理后的list。 实际上2nd，4th会最先执行，执行的时候拿不到1st，3rd里面期望拿到的值。整个循环结束时，异步并未结束，
所以循环结束后期望得到的最后结果无法获得</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">aFn</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> val

<span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> api<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> val<span class="token operator">:</span> <span class="token string">'1st'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> api<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> val<span class="token operator">:</span> <span class="token string">'2nd'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">{</span> api<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> val<span class="token operator">:</span> <span class="token string">'3rd'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> api<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> val<span class="token operator">:</span> <span class="token string">'4th'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> i<span class="token punctuation">,</span> arr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>api <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 调接口类的异步操作</span>
      <span class="token comment">// let res = await new Promise((resolve) =&gt; {resolve(item.val)}) // await api()</span>
      <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">aFn</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>val<span class="token punctuation">)</span> <span class="token comment">// 即使是个看似直接返回的函数，</span>
      <span class="token comment">// 只要包了async，如同下面基础回顾描述的，</span>
      <span class="token comment">// 执行的时候会包成new Promise((resolve) =&gt; {resolve(item.val)})</span>

      <span class="token comment">// 操作item</span>
      item<span class="token punctuation">.</span>val2 <span class="token operator">=</span> res
      <span class="token comment">// 最后打印出来。操作item的影响list的作用效果也会最后出现，上面实际需要的地方拿不到。</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'item.val:'</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>val<span class="token punctuation">)</span>
   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>api <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      item<span class="token punctuation">.</span>val2 <span class="token operator">=</span> item<span class="token punctuation">.</span>val
      <span class="token comment">// 无调接口的异步逻辑,第一个打印出来，操作item的影响list的作用效果，能在需要结果的地方拿到</span>
      <span class="token comment">// （也有下面的巨坑，打印arr，展开arr里面arr[0].val2有值，直接打印arr[0].val2没值）</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'item.val:'</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>val<span class="token punctuation">,</span> <span class="token string">'arr:'</span><span class="token punctuation">,</span> arr<span class="token punctuation">,</span> <span class="token string">'arr[0].val2:'</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>val2<span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 在两个同步之后打印，两个异步还没结束，forEach入参函数async和异步分支中的await失效。</span>
<span class="token comment">// 这里拿不到想要的异步结果，异步逻辑做的item处理效果这里也会漏掉'</span>
<span class="token comment">// 需要结果的地方list[0]和list[3]的val2值拿不到</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'list:'</span><span class="token punctuation">,</span> list<span class="token punctuation">,</span> <span class="token string">'list[0].val2:'</span><span class="token punctuation">,</span> list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>val2<span class="token punctuation">,</span> <span class="token string">'list[1].val2:'</span><span class="token punctuation">,</span> list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>val2<span class="token punctuation">)</span>
<span class="token comment">/**
 * 这里有个超级巨坑！list在浏览器中能打印出来想要的结果，
 * 浏览器打印list，list对象展开看到的是最后的list，
 * 而不是程序执行当时的list（会导致问题怎么都查不出来，能打印出来但是程序却怎么都拿不到）。
 * 通过打印list[0].val2的值，能打印出实际运行时的值。
 */</span>
</code></pre></div><p>打印顺序:</p> <p>item.val: 2nd arr: [{…}, {…}, {…}, {…}] arr[0].val2: undefined // 打印arr，展开arr里面arr[0].val2有值，直接打印arr[0].val2没值</p> <p>item.val: 4th arr: [{…}, {…}, {…}, {…}] arr[0].val2: undefined</p> <p>需要结果的地方，list: (4) [{…}, {…}, {…}, {…}] list[0].val2: undefined // 最后一行console.log拿不到想要的结果</p> <p>item.val: 1st // 最后打印出来。操作item的影响list的作用效果也会最后出现,上面实际需要的地方拿不到。</p> <p>item.val: 3rd // 最后打印出来。操作item的影响list的作用效果也会最后出现,上面实际需要的地方拿不到。</p> <h4 id="基础回顾-async-await编译成支持promise浏览器代码时"><a href="#基础回顾-async-await编译成支持promise浏览器代码时" class="header-anchor">#</a> 基础回顾 async await编译成支持Promise浏览器代码时</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// code here</span>

<span class="token comment">// 编译成</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// code here</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// await后面的语句会包到.then的回调函数中</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn2</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">1</span>
<span class="token punctuation">}</span>

<span class="token comment">// async函数一定会返回一个promise对象。如果一个async函数的返回值看起来不是promise，那么它将会被隐式地包装在一个promise中。</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn2</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="map"><a href="#map" class="header-anchor">#</a> map</h4> <p>map参1函数无法直接使用 async await</p> <p>利用for，for of，reduce自定义map能让map中的async await使的数组按照数组的顺序去执行异步。（参考下面filter，some）</p> <p>下面是让map中所有异步都执行（并行同时执行）都完成后，再执行遍历之后的语句（能保证拿到所有异步的结果）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 对数组元素求平方（无async await的普通map）</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// [1, 4, 9]</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">item</span> <span class="token operator">=&gt;</span> item <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 对数组元素求平方（有async await的map）</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// [Promise, Promise, Promise]</span>
<span class="token comment">// 直接用得不到想要的结果[1, 4, 9]，得到的是Promise数组</span>
</code></pre></div><p>解决方案：用Promise.all来处理直接map后的结果</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// [1, 4, 9]</span>
<span class="token comment">// map对async await算比较友好，生成了一个Promise数组</span>
<span class="token comment">// 只要用Promise.all处理Promise数组，就可以得到想要的最后结果</span>
<span class="token comment">// map的时候，所有Promise已经开始执行了（并行同时执行），</span>
<span class="token comment">// await可以使后面语句在所有async都有结果后，才执行</span>
</code></pre></div><h4 id="reduce-reduceright"><a href="#reduce-reduceright" class="header-anchor">#</a> reduce/reduceRight</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 对数组元素求和（无async await的普通reduce）</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">accumulator<span class="token punctuation">,</span> item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> accumulator <span class="token operator">+</span> item<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// 6</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 对数组元素求和（有async await的reduce）</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">accumulator<span class="token punctuation">,</span> item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> accumulator <span class="token operator">+</span> item<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// Promise{&lt;fulfilled&gt;: &quot;[object Promise]3&quot;}</span>
<span class="token comment">// 直接用得不到想要的结果6，得到的结果貌似很奇怪</span>
<span class="token comment">// 得到的是 Promise转的字符串的结果：[object Promise] 拼接 3转字符串结果，再外面包一层Promise</span>

<span class="token comment">// 因为，reduce最后一次，拿倒数第二次的o，也就是上一个async函数（promise对象）+ 3，</span>
<span class="token comment">// 此时会被转成字符串[object Promise]，再拼接'3'</span>
<span class="token comment">// 然后最终返回时外面因为有async，再包一层Promise</span>
</code></pre></div><p>解决方案：每次使用accumulator，将accumulator（Promise对象）用await得到内容，再+3。</p> <p>reduce的结果是Promise所以最外面还需要一个await得到内容</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">accumulator<span class="token punctuation">,</span> item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token keyword">await</span> accumulator<span class="token punctuation">)</span> <span class="token operator">+</span> item<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// 6</span>
</code></pre></div><p>添加一个延迟函数，看看实际执行顺序。</p> <p>这里非常有意思， 既可以实现每个迭代中的异步按照顺序依次依赖，最后一个迭代结束，计算出reduce结果。 也可以实现，每个迭代中异步同时开始，等到所有迭代都好了，再计出reduce结果。类似与Promise.all的效果。</p> <p>1.每个异步同时开始，等到所有都好了再计算，相当于也有Promise.all的效果</p> <p><strong>将要等待的异步操作语句放在await accumulator之前。 reduce内部本身所有迭代会同时执行，放在await accumulator之前的异步语句会同时开始执行。 碰到await
accumulator会block，因为上一个迭代的promise还在等待状态（即await accumulator还在等待状态）</strong></p> <p>下面例子分析：</p> <p>因为wait1s(1),wait1s(2),wait1s(3)同时执行，所以wait1s分别在6s，4s，2s完成。</p> <p>因为第2秒时完成的是第三个迭代中的wait1s， 第三个迭代走到await accumulator， 因为第三个accumulator需要前面的accumulator变成完成状态后才能开始，所以block在这里。</p> <p>第4秒，第二个迭代同之前第三个迭代，也block在accumulator，因为第一个accumulator还是未完成。</p> <p>第6秒，第一个迭代wait1s结束，走到第一个迭代的accumulator，第一个accumulator是初始值也就是0，不是一个promise，不用等待，直接往下走。
还是第6秒，第一个迭代的accumulator瞬间走完promise状态变成完成，此时第二个accumulator因为它前面的第一个accumulator的promise完成了，
它自身没有block，所以也一下子变成了完成状态，一次类推，第三个accumulator也瞬间变成完成状态。reduce所有迭代都走到了最后。 reduce的结果就出来了。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">wait1s</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'i:'</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token comment">// 按照延迟时间打印，2秒打印第三个i:2，</span>
      <span class="token comment">// 第4秒打印二个i:1，第6秒打印二个i:0</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">-</span> i<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> saveArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">accumulator<span class="token punctuation">,</span> item<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'reduce开始'</span><span class="token punctuation">)</span> <span class="token comment">// 3个瞬间连续打印</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'item:'</span><span class="token punctuation">,</span> item<span class="token punctuation">,</span> <span class="token string">'saveArr:'</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 3个瞬间连续打印，saveArr都是undefined</span>

  saveArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">wait1s</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment">// 同时开始执行3个wait1s，返回promise，延时函数已经开始计时，秒数到之前block下面语句</span>
  <span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">await</span> accumulator<span class="token punctuation">)</span> <span class="token operator">+</span> item <span class="token comment">// accumulator是前一个迭代返回的promise，会被前面promise的等待状态block</span>
  <span class="token comment">// 只有第一个是默认值，不是promise，不会被block</span>
  <span class="token comment">// 前一个迭代的promise(即本次accumulator)状态变成完成后，这句马上继续马上往下走，本身没有其他等待的动作</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'item:'</span><span class="token punctuation">,</span> item<span class="token punctuation">,</span> <span class="token string">'saveArr:'</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// 这里相当于reduce被block住，所有延迟结束后在计算最后结果，三个结果一起打印</span>
  <span class="token keyword">return</span> r
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 6秒后，也就是reduce里面的语句都走完了，拿到所有等待后结果，计算reduce的最后结果</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// 6</span>
</code></pre></div><p>打印结果如下：</p> <p>reduce开始 // 第0秒打印</p> <p>item: 1 saveArr: undefined undefined undefined // 第0秒打印</p> <p>reduce开始 // 第0秒打印</p> <p>item: 2 saveArr: undefined undefined undefined // 第0秒打印</p> <p>reduce开始 // 第0秒打印</p> <p>item: 3 saveArr: undefined undefined undefined // 第0秒打印</p> <p>i: 2 // 第2秒打印</p> <p>i: 1 // 第4秒打印</p> <p>i: 0 // 第6秒打印</p> <p>item: 1 saveArr: 0 1 2 // 第6秒打印</p> <p>item: 2 saveArr: 0 1 2 // 第6秒打印</p> <p>item: 3 saveArr: 0 1 2 // 第6秒打印</p> <p>6 // 第6秒打印</p> <p>2.每个异步按照顺序依次依赖执行</p> <p><em><strong>与上面代码唯一的区别就是await wait1s(i)语句和 await accumulator语句交换了顺序</strong></em></p> <p>下面例子分析：</p> <p>每个迭代accumulator前面的语句，按顺序瞬间一起执行， 执行到accumulator，除了第一个都被前一个迭代promise的状态是等待block住， 第一个迭代直接执行到accumulator，进入延时函数，第一个开始延时。</p> <p>6s后延时结束，wait1s的promise状态变成完成，第一个迭代后面没有异步语句，所以一下子都走完。 第二个迭代accumulator状态因此瞬间变成完成，第二个wait1s执行，第二个开始延时。</p> <p>同上， 第10秒，第二个迭代的wait1s的promise状态变成完成，第二个迭代后面没有异步语句，所以一下子都走完。 第三个迭代accumulator状态因此瞬间变成完成，第三个wait1s执行，第三个开始延时。</p> <p>同上，第12秒第三个迭代的wait1s的promise状态变成完成，第二个迭代后面语句一下子都走完。 reduce里的迭代都走完，开始走reduce的最终结果计算</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">wait1s</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'i:'</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token comment">// 第6秒打印i:0， 第10秒打印i:1，第12秒打印i:2，</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">-</span> i<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> saveArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">accumulator<span class="token punctuation">,</span> item<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'reduce开始'</span><span class="token punctuation">)</span> <span class="token comment">// 3个瞬间连续打印</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'item:'</span><span class="token punctuation">,</span> item<span class="token punctuation">,</span> <span class="token string">'saveArr:'</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 3个瞬间连续打印，saveArr都是undefined</span>

  <span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">await</span> accumulator<span class="token punctuation">)</span> <span class="token operator">+</span> item <span class="token comment">// accumulator是前一个迭代返回的promise，会被前面promise的等待状态block</span>
  <span class="token comment">// 只有第一个是默认值，不是promise，不会被block。这里就是第一个，直接走完，accumulator的promise状态变成成功</span>
  <span class="token comment">// 第二个以及之后的await accumulator也已经走到，也会立刻建立promise，但因为之前的迭代返回promise状态没有完成，promise状态保持等待，block在这里</span>

  saveArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">wait1s</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment">// 第一个wait1s因为第一个accumulator直接成功，这里也可以直接开始，延时函数开始计时。当第一个延时6秒结束</span>
  <span class="token comment">// 第二个accumulator（即第一个迭代返回值的promise）才完成，走到第二个wait1s，第二个延时函数开始</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'item:'</span><span class="token punctuation">,</span> item<span class="token punctuation">,</span> <span class="token string">'saveArr:'</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token comment">// 这里6s，10s，12s打印</span>
  <span class="token keyword">return</span> r
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 第12秒，最后一个迭代的语句也走完了，计算reduce的最后结果</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// 6</span>
</code></pre></div><p>打印结果如下：</p> <p>reduce开始 // 第0秒打印</p> <p>item: 1 saveArr: undefined undefined undefined // 第0秒打印</p> <p>reduce开始 // 第0秒打印</p> <p>item: 2 saveArr: undefined undefined undefined // 第0秒打印</p> <p>reduce开始 // 第0秒打印</p> <p>item: 3 saveArr: undefined undefined undefined // 第0秒打印</p> <p>i: 0 // 第6秒打印</p> <p>item: 1 saveArr: 0 undefined undefined // 第6秒打印</p> <p>i: 1 // 第10秒打印</p> <p>item: 2 saveArr: 0 1 undefined // 第10秒打印</p> <p>i: 2 // 第12秒打印</p> <p>item: 3 saveArr: 0 1 2 // 第12秒打印</p> <p>6 // 第12秒打印</p> <h4 id="filter"><a href="#filter" class="header-anchor">#</a> filter</h4> <p>可以让map中所有异步都执行（并行同时执行）都完成后，再执行遍历之后的语句（能保证拿到所有异步的结果）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 对数组元素选取奇数项（无async await的普通filter）</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// [1, 3]</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">item</span> <span class="token operator">=&gt;</span> item <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 对数组元素选取奇数项（有async await的filter）</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// [1, 2, 3]</span>
<span class="token comment">// 直接用得不到想要的结果[1, 3]，得到的是错误的结果[1, 2, 3]</span>
<span class="token comment">// 因为async函数返回一个promise，filter根据返回值判断是否需要过滤，promise判断永远是true，所以过滤功能失效。</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">item</span> <span class="token operator">=&gt;</span> item <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 对数组元素求平方（有async await的map）</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// [1, 2, 3]</span>
<span class="token comment">// 直接用得不到想要的结果[1, 3]，得到的是错误的结果[1, 2, 3]</span>
<span class="token comment">// 因为async函数返回一个promise，filter根据返回值判断是否需要过滤，promise判断永远是true，所以过滤功能失效。</span>
</code></pre></div><p>添加一个延迟函数，看看实际执行顺序</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">wait1s</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'i:'</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">-</span> i<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'filter开始，item:'</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span> <span class="token comment">// 3个filter会一起瞬间开始，这里开始就连续打印3个</span>
  <span class="token keyword">let</span> iR <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">wait1s</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'item:'</span><span class="token punctuation">,</span> item<span class="token punctuation">,</span> <span class="token string">'iR:'</span><span class="token punctuation">,</span> iR<span class="token punctuation">)</span> <span class="token comment">// 按照延迟时间打印，2秒打印第三个i:2，</span>
  <span class="token keyword">return</span> item <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!==</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 对数组元素求平方（有async await的map）</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// [1, 2, 3]</span>
<span class="token comment">// 直接用得不到想要的结果[1, 3]，得到的是错误的结果[1, 2, 3]</span>
<span class="token comment">// 因为async函数返回一个promise，filter根据返回值判断是否需要过滤，promise判断永远是true，所以过滤功能失效。</span>
</code></pre></div><p>打印结果如下：</p> <p>filter开始，item: 1 // 开始就打印</p> <p>filter开始，item: 2 // 开始就打印</p> <p>filter开始，item: 3 // 开始就打印</p> <p>[1, 2, 3] // 开始就打印</p> <p>i: 2 // 2秒打印</p> <p>item: 3 iR: 2 // 2秒打印</p> <p>i: 1 // 4秒打印</p> <p>item: 2 iR: 1 // 4秒打印</p> <p>i: 0 // 6秒打印</p> <p>item: 1 iR: 0 // 6秒打印</p> <h4 id="解决方案1-自己重写一个方法-用map-和-promise-all来处理拿到结果-最后再用filter处理。-添加一个延迟函数-看看实际执行顺序"><a href="#解决方案1-自己重写一个方法-用map-和-promise-all来处理拿到结果-最后再用filter处理。-添加一个延迟函数-看看实际执行顺序" class="header-anchor">#</a> 解决方案1：自己重写一个方法，用map 和 Promise.all来处理拿到结果，最后再用filter处理。（添加一个延迟函数，看看实际执行顺序）</h4> <p>方案一效果，迭代之间没有先后顺序，一起开始执行，都执行完了Promise.all拿到结果。</p> <p>原生map参数1-函数中的await不能使迭代之间有等待的效果</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">wait1s</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'i:'</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">-</span> i<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">filterSync</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">callback<span class="token punctuation">,</span> thisArg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// thisArd： 原生filter第二个可选参数</span>
  <span class="token comment">// 可选。传递给函数的值一般用 &quot;this&quot; 值。</span>
  <span class="token comment">// 如果这个参数为空， &quot;undefined&quot; 会传递给 &quot;this&quot; 值</span>
  <span class="token keyword">let</span> resultAll <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [true, false, true]</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> resultAll<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filterSync</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'filter开始，item:'</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span> <span class="token comment">// 3个filter会一起瞬间开始，这里开始就连续打印3个</span>
  <span class="token keyword">let</span> iR <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">wait1s</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'item % 2 !== 0:'</span><span class="token punctuation">,</span> item <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'iR:'</span><span class="token punctuation">,</span> iR<span class="token punctuation">)</span> <span class="token comment">// 按照延迟时间打印，2秒打印第三个i:2，</span>
  <span class="token comment">// 第4秒打印二个i:1，第6秒打印二个i:0</span>
  <span class="token keyword">return</span> item <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!==</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
</code></pre></div><p>打印结果</p> <p>filter开始，item: 1 // 第0秒打印</p> <p>filter开始，item: 2 // 第0秒打印</p> <p>filter开始，item: 3 // 第0秒打印</p> <p>4 i: 2 // 第2秒打印</p> <p>item % 2 !== 0: true iR: 2 // 第2秒打印</p> <p>i: 1 // 第4秒打印</p> <p>item % 2 !== 0: false iR: 1 // 第4秒打印</p> <p>i: 0 // 第6秒打印</p> <p>item % 2 !== 0: true iR: 0 // 第6秒打印</p> <p>[1, 3] // 第6秒打印</p> <h4 id="解决方案2-自己重写一个方法-用for或for-of-或-reduce来处理。迭代之间会相互等待-最后一个结果也拿到之后-所有结果filter一下"><a href="#解决方案2-自己重写一个方法-用for或for-of-或-reduce来处理。迭代之间会相互等待-最后一个结果也拿到之后-所有结果filter一下" class="header-anchor">#</a> 解决方案2：自己重写一个方法，用for或for of 或 reduce来处理。迭代之间会相互等待，最后一个结果也拿到之后，所有结果filter一下</h4> <p>方案二最终效果：迭代之间有先后顺序，后面的迭代会等前面的迭代中异步完成之后才执行</p> <p><strong>重要理解：</strong></p> <p><strong>reduce参数1-函数中的await能使迭代之间等待 （个人理解，对比map，map本身迭代之间没有联系，所以设计成await不等待，并行执行；
而reduce每个迭代需要上个迭代的结果才能往下计算，所以设计成await等待，按顺序依次执行）</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">wait1s</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'i:'</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">-</span> i<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> saveArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">filterSync</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">callback<span class="token punctuation">,</span> thisArg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// thisArd： 原生filterh第二个可选参数</span>
  <span class="token comment">// 可选。传递给函数的值一般用 &quot;this&quot; 值。</span>
  <span class="token comment">// 如果这个参数为空， &quot;undefined&quot; 会传递给 &quot;this&quot; 值</span>

  <span class="token comment">// reduce和filter,forEach,map不同，不能支持传入this</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">accumulator<span class="token punctuation">,</span> item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    <span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token keyword">await</span> accumulator <span class="token comment">// accumulator是上次async函数的返回</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'item:'</span><span class="token punctuation">,</span> item<span class="token punctuation">,</span> <span class="token string">'saveArr:'</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span> index<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>r<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token comment">// 这里很重要，这里是callback里面的wait1s，在accumulator后面，所以和reduce里面第二种解决方案执行结果一样</span>

    <span class="token keyword">return</span> r
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token comment">/*  const res = await (this.reduce(async (accumulator, item, index) =&gt; { // await accumulator后面没用变量r代替，这样写和上面一样效果， 
      //同一个promise结果是相同的，不会因为用的是变量还是原来的await表现的不同
      
      let r = await accumulator // accumulator是上次async函数的返回
      if (await callback(this[index], index)) {(await accumulator).push(item)}
      return (await accumulator)
    }, []))
    console.log(res) // [1, 3] */</span>
  <span class="token keyword">return</span> res
<span class="token punctuation">}</span>

<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filterSync</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> i<span class="token punctuation">,</span> arr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'filter开始，item:'</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span> <span class="token comment">// 3个不会一起瞬间开始，</span>
  saveArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">wait1s</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  <span class="token comment">// 第二个wait1s会等第一个迭代的异步完成才执行，能拿到第一个的异步结果，可以通过saveArr的内容发现</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'item % 2 !== 0:'</span><span class="token punctuation">,</span> item <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'saveArr:'</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> item <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!==</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// [1, 3]</span>

</code></pre></div><p>打印结果如下：</p> <p>filter开始，item: 1 // 第0秒打印</p> <p>i: 0 // 第6秒打印</p> <p>item % 2 !== 0: true saveArr: 0 undefined undefined // 第6秒打印， 拿不到第二次第三次迭代的内容，因为第二次第三次迭代还没开始</p> <p>filter开始，item: 2 // 第6秒打印</p> <p>i: 1 // 第10秒打印</p> <p>item % 2 !== 0: false saveArr: 0 1 undefined // 第10秒打印，第二次迭代执行是在第一次得到结果之后的，自然能拿到第一次的结果</p> <p>filter开始，item: 3 // 第10秒打印</p> <p>i: 2 // 第12秒打印</p> <p>item % 2 !== 0: true saveArr: 0 1 2 // 第12秒打印</p> <p>[1, 3] // 第12秒打印</p> <p>[1, 3] // 第12秒打印 // 代码最后一行打印</p> <h4 id="some"><a href="#some" class="header-anchor">#</a> some</h4> <p>some 和 filter 有些相像，参1函数返回布尔，决定最后结果，区别是，filter通过布尔挑选最后选哪几个元素，some通过所有布尔得出一个最终布尔</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> item <span class="token operator">===</span> <span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// （无async await的普通some）</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// false</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> item <span class="token operator">===</span> <span class="token number">4</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//（有async await的some）,也是因为返回值是promise，所以永远是true，some语句失效</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre></div><h4 id="解决方案1-自己重写一个方法-用map-和-promise-all来处理拿到结果-最后再用some处理。-添加一个延迟函数-看看实际执行顺序"><a href="#解决方案1-自己重写一个方法-用map-和-promise-all来处理拿到结果-最后再用some处理。-添加一个延迟函数-看看实际执行顺序" class="header-anchor">#</a> 解决方案1：自己重写一个方法，用map 和 Promise.all来处理拿到结果，最后再用some处理。（添加一个延迟函数，看看实际执行顺序）</h4> <p>方案一最终效果，迭代之间没有先后顺序，一起开始执行，都执行完了往下走。与filter的方案1一样。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">wait1s</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'i:'</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">-</span> i<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">someSync</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">callback<span class="token punctuation">,</span> thisArg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// thisArd： 原生filter第二个可选参数</span>
  <span class="token comment">// 可选。传递给函数的值一般用 &quot;this&quot; 值。</span>
  <span class="token comment">// 如果这个参数为空， &quot;undefined&quot; 会传递给 &quot;this&quot; 值</span>
  <span class="token keyword">let</span> resultAll <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [true, false, true]</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> resultAll<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">someSync</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'some开始，item:'</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span> <span class="token comment">// 3个some会一起瞬间开始，这里开始就连续打印3个</span>
  <span class="token keyword">let</span> iR <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">wait1s</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'item === 4:'</span><span class="token punctuation">,</span> item <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">// 按照延迟时间打印，2秒打印第三个i:2，</span>
  <span class="token comment">// 第4秒打印二个i:1，第6秒打印二个i:0</span>
  <span class="token keyword">return</span> item <span class="token operator">===</span> <span class="token number">4</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
</code></pre></div><p>打印结果如下：</p> <p>some开始，item: 1 // 第0秒打印</p> <p>some开始，item: 2 // 第0秒打印</p> <p>some开始，item: 3 // 第0秒打印</p> <p>i: 2 // 第2秒打印</p> <p>item === 4: false // 第2秒打印</p> <p>i: 1 // 第4秒打印</p> <p>item === 4: false // 第4秒打印</p> <p>i: 0 // 第6秒打印</p> <p>item === 4: false // 第6秒打印</p> <p>false // 第6秒打印</p> <h4 id="解决方案2-自己重写一个方法-用reduce来处理。"><a href="#解决方案2-自己重写一个方法-用reduce来处理。" class="header-anchor">#</a> 解决方案2：自己重写一个方法，用reduce来处理。</h4> <p>方案二最终效果：迭代之间有先后顺序，后面的迭代会等前面的迭代中异步完成之后才执行，与filter方案二一样。</p> <p>some方案2，实用场景，接口速度很快，多次等待前端体验仍可以保证，中途得到结果后，之后的接口可以不调取，节省后端资源。 但其实，reduce因为语法上无法打断（所以第二种方案丢弃，前端体验不好，后端资源并没有节省），故用for
of的第三种方案</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">wait1s</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'i:'</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">-</span> i<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">someSync</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">callback<span class="token punctuation">,</span> thisArg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// thisArd： 原生filterh第二个可选参数</span>
  <span class="token comment">// 可选。传递给函数的值一般用 &quot;this&quot; 值。</span>
  <span class="token comment">// 如果这个参数为空， &quot;undefined&quot; 会传递给 &quot;this&quot; 值</span>

  <span class="token comment">// reduce和filter,forEach,map不同，不能支持传入this</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">accumulator<span class="token punctuation">,</span> item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    <span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token keyword">await</span> accumulator <span class="token comment">// accumulator是上次async函数的返回</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span> index<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>r <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">}</span> <span class="token comment">// 这里很重要，这里是callback里面的wait1s，在accumulator后面，所以和reduce里面第二种解决方案执行结果一样</span>

    <span class="token keyword">return</span> r
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> res
<span class="token punctuation">}</span>

<span class="token keyword">let</span> saveArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">someSync</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> i<span class="token punctuation">,</span> arr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'some开始，item:'</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span> <span class="token comment">// 3个不会一起瞬间开始，</span>
  saveArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">wait1s</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  <span class="token comment">// 第二个会等第一个迭代的异步完成才执行，能拿到第一个的异步结果，可以通过saveArr的内容发现</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'item === 4:'</span><span class="token punctuation">,</span> item <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'saveArr:'</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> item <span class="token operator">===</span> <span class="token number">4</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// false</span>
</code></pre></div><p>打印结果如下：</p> <p>some开始，item: 1 // 第0秒打印</p> <p>i: 0 // 第6秒打印</p> <p>item === 4: true saveArr: 0 undefined undefined // 第6秒打印， 拿不到第二次第三次迭代的内容，因为第二次第三次迭代还没开始</p> <p>some开始，item: 2 // 第6秒打印</p> <p>i: 1 // 第10秒打印</p> <p>item === 4: false saveArr: 0 1 undefined // 第10秒打印，第二次迭代执行是在第一次得到结果之后的，自然能拿到第一次的结果</p> <p>some开始，item: 3 // 第10秒打印</p> <p>i: 2 // 第12秒打印</p> <p>item === 4: false saveArr: 0 1 2 // 第12秒打印</p> <p>false // 第12秒打印</p> <h4 id="解决方案3-自己重写一个方法-用for或for-of来处理。"><a href="#解决方案3-自己重写一个方法-用for或for-of来处理。" class="header-anchor">#</a> 解决方案3：自己重写一个方法，用for或for of来处理。</h4> <p>方案三最终效果：迭代之间有先后顺序，后面的迭代会等前面的迭代中异步完成之后才执行，与some方案二一样，但是可以中途停止。</p> <p>some方案3，实用场景，接口速度很快，多次等待前端体验仍可以保证，中途得到结果后，之后的接口可以不调取，节省后端资源。</p> <p><strong>重要理解：</strong></p> <p><strong>for of 循环中await也有效果，迭代会一次执行，比起reduce多了中断循环的作用</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">wait1s</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'i:'</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">-</span> i<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">someSync</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">callback<span class="token punctuation">,</span> thisArg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// thisArd： 原生some第二个可选参数</span>
  <span class="token comment">// 可选。传递给函数的值一般用 &quot;this&quot; 值。</span>
  <span class="token comment">// 如果这个参数为空， &quot;undefined&quot; 会传递给 &quot;this&quot; 值</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>index<span class="token punctuation">,</span> item<span class="token punctuation">]</span> <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">callback</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> index<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span> <span class="token comment">// 当匹配到可以通过return跳出循环</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> saveArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">someSync</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> i<span class="token punctuation">,</span> arr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'some开始，item:'</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span> <span class="token comment">// 3个不会一起瞬间开始，</span>
  saveArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">wait1s</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  <span class="token comment">// 第二个会等第一个迭代的异步完成才执行，能拿到第一个的异步结果，可以通过saveArr的内容发现</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'item === 4:'</span><span class="token punctuation">,</span> item <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'saveArr:'</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> item <span class="token operator">===</span> <span class="token number">4</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// false</span>
</code></pre></div><p>打印结果如下：</p> <p>some开始，item: 1 // 第0秒打印</p> <p>i: 0 // 第6秒打印</p> <p>item === 4: true saveArr: 0 undefined undefined // 第6秒打印， 拿不到第二次第三次迭代的内容，因为第二次第三次迭代还没开始</p> <p>some开始，item: 2 // 第6秒打印</p> <p>i: 1 // 第10秒打印</p> <p>item === 4: false saveArr: 0 1 undefined // 第10秒打印，第二次迭代执行是在第一次得到结果之后的，自然能拿到第一次的结果</p> <p>some开始，item: 3 // 第10秒打印</p> <p>i: 2 // 第12秒打印</p> <p>item === 4: false saveArr: 0 1 2 // 第12秒打印</p> <p>false // 第12秒打印</p> <h4 id="every"><a href="#every" class="header-anchor">#</a> every</h4> <p>every 与 some一样无法直接用async await</p> <p>改造方法与every一样，只是逻辑判断有所不同，some有一个true跳出循环结果为true;</p> <p>every有一个false跳出循环，结果为false.</p> <h4 id="foreach"><a href="#foreach" class="header-anchor">#</a> forEach</h4> <p>forEach没有整体返回值，无法直接Promise.all直接处理结果</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 1 // 4 // 9  // 依次打印1，4，9</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 对数组元素求平方（无async await的普通forEach）</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// undefined // forEach没有返回值</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 1 // 4 // 9  // 依次打印1，4，9</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 对数组元素求平方（有async await的forEach）</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// undefined // 无论res=后加不加await，都是undefined，forEach没有返回值</span>
</code></pre></div><p>添加一个延迟函数，看看实际执行顺序. 下面forEach中的async await无法使的每个迭代按照顺序去等待上一个迭代结束再执行下一个迭代。</p> <p>一起开始，自己结束了就自己打印。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">wait1s</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'i:'</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">-</span> i<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> saveArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 即使加了这个await，也没有效果</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'forEach开始，item:'</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span> <span class="token comment">// 3个forEach会一起瞬间开始，这里开始就连续打印3个</span>
  saveArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">wait1s</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'item:'</span><span class="token punctuation">,</span> item<span class="token punctuation">,</span> <span class="token string">'saveArr:'</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 按照延迟时间打印，2秒打印第三个i:2，</span>
  <span class="token comment">// 第4秒打印二个i:1，第6秒打印二个i:0</span>
  <span class="token keyword">return</span> item
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'res'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token comment">// undefined // 开始瞬间打印3个forEach后，立即打印undefined</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Last:'</span><span class="token punctuation">,</span> <span class="token string">'arr:'</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'saveArr:'</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

</code></pre></div><p>打印结果如下：</p> <p>forEach开始，item: 1 // 第0秒打印</p> <p>forEach开始，item: 2 // 第0秒打印</p> <p>forEach开始，item: 3 // 第0秒打印</p> <p>res undefined // 第0秒打印</p> <p>Last: arr: 1 2 3 saveArr: undefined undefined undefined // 第0秒打印</p> <p>i: 2 // 第2秒打印</p> <p>item: 3 saveArr: undefined undefined 2 // 第2秒打印</p> <p>i: 1 // 第4秒打印</p> <p>item: 2 saveArr: undefined 1 2 // 第4秒打印</p> <p>i: 0 // 第4秒打印</p> <p>item: 1 saveArr: 0 1 2 // 第4秒打印</p> <p>能够看出，在forEach中用async await，完全不等，迭代一起开始，之间没有先后顺序依赖，也无法直接拿到全部等待结束后的结果</p> <h4 id="自定义foreach-用于async-await"><a href="#自定义foreach-用于async-await" class="header-anchor">#</a> 自定义forEach 用于async await</h4> <p>处理方案一，利用for或for of编写一个自定义forEach函数，并添加一个延迟函数，看看实际执行顺序。</p> <p>可以实现每次迭代之间的等待。即：i:0第6秒出结果，i:1第10秒出结果，i:0第12秒出结果，最后整体给一个返回值</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">forEachSync</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">callback<span class="token punctuation">,</span> thisArg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// thisArg： 原生forEach第二个可选参数</span>
  <span class="token comment">// 可选。传递给函数的值一般用 &quot;this&quot; 值。</span>
  <span class="token comment">// 如果这个参数为空， &quot;undefined&quot; 会传递给 &quot;this&quot; 值</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>index<span class="token punctuation">,</span> item<span class="token punctuation">]</span> <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// for of 中的async await竟然有等待效果</span>
    <span class="token keyword">await</span> <span class="token function">callback</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> index<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span> <span class="token comment">// 把变化后的数组返回出去，使forEachSync有返回值</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">wait1s</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'i:'</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">-</span> i<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> saveArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 存储异步结果</span>
<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> arr<span class="token punctuation">.</span><span class="token function">forEachSync</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> i<span class="token punctuation">,</span> arr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'forEach开始，item:'</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span> <span class="token comment">// 3个forEach开始会按顺序，和时间间隔6，4，2打印。而不是上面一起打印。</span>
  saveArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">wait1s</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> item <span class="token operator">**</span> <span class="token number">2</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'saveArr:'</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// iR能拿到，相当于，每次迭代都能拿到上次迭代的异步结果</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
</code></pre></div><p>打印结果如下：</p> <p>forEach开始，item: 1 // 第0秒打印</p> <p>i: 0 // 第6秒打印</p> <p>1 &quot;saveArr:&quot; &quot;0&quot; undefined undefined // 第6秒打印</p> <p>forEach开始，item: 2 // 第6秒打印</p> <p>i: 1 // 第10秒打印</p> <p>4 &quot;saveArr:&quot; &quot;0&quot; &quot;1&quot; undefined // 第10秒打印</p> <p>forEach开始，item: 3 // 第10秒打印</p> <p>i: 2 // 第12秒打印</p> <p>9 &quot;saveArr:&quot; &quot;0&quot; &quot;1&quot; &quot;2&quot; // 第12秒打印</p> <p>[1,4,9] // 第12秒打印</p> <p>处理方案二，编写一个自定义forEach函数，并行所有迭代，最后都执行完，用Promise.all。请参考map处理方法，或filter处理方法1</p> <h3 id="for"><a href="#for" class="header-anchor">#</a> for</h3> <p>for迭代没有返回值，也不能return，return了会报错</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">wait1s</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'i:'</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">-</span> i<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> saveArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 存储异步结果</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// for前不需要加await，最后一句也会等待</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'for开始，arr[i]:'</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 3个不会一起瞬间开始，</span>
  saveArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">wait1s</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  <span class="token comment">// 第二个会等第一个迭代的异步完成才执行，能拿到第一个的异步结果，可以通过saveArr的内容发现</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'arr[i]:'</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'saveArr:'</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">2</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'arr:'</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'saveArr:'</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> saveArr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>打印结果如下：</p> <p>for开始，arr[i]: 1 // 第0秒打印</p> <p>i: 0 // 第2秒打印</p> <p>arr[i]: 1 saveArr: 0 undefined undefined // 第2秒打印</p> <p>for开始，arr[i]: 2 // 第2秒打印</p> <p>i: 1 // 第4秒打印</p> <p>arr[i]: 2 saveArr: 0 1 undefined // 第4秒打印</p> <p>for开始，arr[i]: 3 // 第4秒打印</p> <p>i: 2 // 第6秒打印</p> <p>arr[i]: 3 saveArr: 0 1 2 // 第6秒打印</p> <p>arr: 2 4 6 saveArr: 0 1 2 // 第6秒打印，最后一句最后打印，for前不需要加await，最后一句也会等待</p> <p><em><strong>综上所述</strong></em></p> <p><em><strong>结合async await使用时</strong></em></p> <p><em><strong>for, for of：</strong></em></p> <p><em><strong>可以直接使用</strong></em></p> <ol><li><em><strong>迭代本身没有返回值</strong></em></li> <li><em><strong>本来就是同步语句，前面不需要加await，整个循环下面的语句就会等</strong></em></li> <li><em><strong>循环迭代中的等待会影响下一轮迭代，即第二个迭代会等第一个迭代结束之后再开始</strong></em></li> <li><em><strong>上一轮循环的等待结果（如异步接口返回）如果存起来，下一轮迭代运行时可以拿到</strong></em></li> <li><em><strong>迭代可以随时退出，在有需要的地方可以提升性能</strong></em></li> <li><em><strong>可以用于改写自定义map，some，every，forEach,用于支持async await， 改写成迭代之间会等待-迭代顺序运行，后面迭代可以依赖前面迭代异步结果!!!filter逻辑上要所有数据过滤出来结果，
一般不适合迭代之间先后依赖和打断操作</strong></em></li></ol> <p><em><strong>直接使用，需要有所改动（具体见上面reduce）</strong></em></p> <ol><li><em><strong>迭代本身有返回值</strong></em></li> <li><em><strong>每次迭代返回值都会因为是async函数被包一层promise，用之前需要用await解开</strong></em></li> <li><em><strong>最后的返回值也会因为是async函数被包一层promise，所以最后结果也要用await解开</strong></em></li> <li><em><strong>可以实现和for，for of一样的迭代之间有依赖，一次执行的效果。异步等待写在accumulator(即上一次迭代返回的promise)后面，通过accumulator来block异步操作的开始。</strong></em></li> <li><em><strong>也可以实现异步一起执行，异步都完成后Promise.all一起处理的效果。异步等待写在accumulator(即上一次迭代返回的promise)前面，因为reduce所有迭代本身都会一起开始执行。</strong></em></li> <li><em><strong>相较与for，for of，reduce迭代无法中断，无法做条件判断中断的性能优化</strong></em></li> <li><em><strong>可以用于改写自定义map，some，every，forEach的两种方式改写。</strong></em></li> <li><em><strong>filter逻辑上要所有数据过滤出来结果， 一般不适合迭代之间先后依赖和打断操作，所有不会用reduce改写</strong></em></li></ol> <p><em><strong>forEach：</strong></em></p> <p><em><strong>直接使用不会报错，但是无法按照理想中的需求执行，无法直接使用</strong></em></p> <ol><li><em><strong>迭代本身没有返回值</strong></em></li> <li><em><strong>前面即使加await，整个循环下面的语句不会等待</strong></em></li> <li><em><strong>迭代一起开始，相互无依赖，无顺序，所有迭代异步完成后也没有回调</strong></em></li> <li><em><strong>自定义forEach，方案1：用for,for of,reduce可以实现迭代顺序执行，相互等待，
最后一个迭代完成后（或者中途跳出后），再运行迭代后面语句一起处理（如过用reduce，见reduce方案1，注意关键语句先后顺序）；
方案2：用map,forEach等将promise推到数组中，Promise.all可以实现迭代同时并行执行， 结果都得到之后，再运行迭代后面语句一起处理。也可用reduce实现，见reduce方案1，注意关键语句先后顺序</strong></em></li></ol> <p><em><strong>map filter some every：</strong></em></p> <p><em><strong>因为参1函数返回必定是Promise，直接运行逻辑上肯定是错误的，所以无法直接使用</strong></em></p> <ol><li><em><strong>可以自定义函数实现需要的功能，方案1：用for,for of,reduce可以实现迭代顺序执行，相互等待，
最后一个迭代完成后（或者中途跳出后），再运行迭代后面语句一起处理（如过用reduce，见reduce方案1，注意关键语句先后顺序）；
方案2：用map,forEach等将promise推到数组中，Promise.all可以实现迭代同时并行执行， 结果都得到之后，再运行迭代后面语句一起处理。也可用reduce实现，见reduce方案1，注意关键语句先后顺序</strong></em></li> <li><em><strong>filter一般直接用Promise.all方案改写，原因见for第6条</strong></em></li></ol> <h3 id="await-无限等待"><a href="#await-无限等待" class="header-anchor">#</a> await 无限等待</h3> <p>new Promise 时如果不resolve，await可以一直卡着后面代码。（await转译成回调形式，回调形式永远不调回调，所以会调里面的永远不会运行）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">wait1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">//如果不调用resolve</span>
      <span class="token comment">// setTimeout(()=&gt;{resolve({})},5000)</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">back</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">await</span> <span class="token function">wait1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'reload!!!!!2222'</span><span class="token punctuation">)</span> <span class="token comment">// 如果不调用resolve，这里会一直被wait卡着，不打印</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="console"><a href="#console" class="header-anchor">#</a> console</h3> <h3 id="打印dom信息"><a href="#打印dom信息" class="header-anchor">#</a> 打印dom信息</h3> <ol><li>把它作为数组的一项或者是对象的一个属性值</li> <li>console.dir()</li></ol> <h3 id="打印对象"><a href="#打印对象" class="header-anchor">#</a> 打印对象</h3> <p>运行中打印对象会显示运行最后的结果，需要打印当时的结果：</p> <p>console.log(JSON.stringify(obj)) 或者深拷贝</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/2/2022, 7:24:39 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/js/base/set/" class="prev">
        set
      </a></span> <span class="next"><a href="/js/base/request/">
        request
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.06410148.js" defer></script><script src="/assets/js/2.493bf590.js" defer></script><script src="/assets/js/49.84061ec5.js" defer></script>
  </body>
</html>
