"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2850],{3905:(n,e,t)=>{t.d(e,{Zo:()=>d,kt:()=>m});var r=t(7294);function o(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function a(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function i(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?a(Object(t),!0).forEach((function(e){o(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function l(n,e){if(null==n)return{};var t,r,o=function(n,e){if(null==n)return{};var t,r,o={},a=Object.keys(n);for(r=0;r<a.length;r++)t=a[r],e.indexOf(t)>=0||(o[t]=n[t]);return o}(n,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);for(r=0;r<a.length;r++)t=a[r],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(o[t]=n[t])}return o}var s=r.createContext({}),c=function(n){var e=r.useContext(s),t=e;return n&&(t="function"==typeof n?n(e):i(i({},e),n)),t},d=function(n){var e=c(n.components);return r.createElement(s.Provider,{value:e},n.children)},p={inlineCode:"code",wrapper:function(n){var e=n.children;return r.createElement(r.Fragment,{},e)}},f=r.forwardRef((function(n,e){var t=n.components,o=n.mdxType,a=n.originalType,s=n.parentName,d=l(n,["components","mdxType","originalType","parentName"]),f=c(t),m=o,u=f["".concat(s,".").concat(m)]||f[m]||p[m]||a;return t?r.createElement(u,i(i({ref:e},d),{},{components:t})):r.createElement(u,i({ref:e},d))}));function m(n,e){var t=arguments,o=e&&e.mdxType;if("string"==typeof n||o){var a=t.length,i=new Array(a);i[0]=f;var l={};for(var s in e)hasOwnProperty.call(e,s)&&(l[s]=e[s]);l.originalType=n,l.mdxType="string"==typeof n?n:o,i[1]=l;for(var c=2;c<a;c++)i[c]=t[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}f.displayName="MDXCreateElement"},5901:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>s,contentTitle:()=>i,default:()=>p,frontMatter:()=>a,metadata:()=>l,toc:()=>c});var r=t(7462),o=(t(7294),t(3905));const a={},i=void 0,l={unversionedId:"js/function_collection/function_collection",id:"js/function_collection/function_collection",title:"function_collection",description:"dom\u8f6cpdf\u4e0b\u8f7d",source:"@site/docs/js/function_collection/function_collection.mdx",sourceDirName:"js/function_collection",slug:"/js/function_collection/",permalink:"/docs/js/function_collection/",draft:!1,tags:[],version:"current",lastUpdatedAt:1669064019,formattedLastUpdatedAt:"2022\u5e7411\u670821\u65e5",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"flow",permalink:"/docs/js/flow/"},next:{title:"date",permalink:"/docs/js/function_collection/date/"}},s={},c=[{value:"dom\u8f6cpdf\u4e0b\u8f7d",id:"dom\u8f6cpdf\u4e0b\u8f7d",level:3},{value:"headers\u62ff\u4e0d\u5230\u5b8c\u6574,\u62ffheaders\u91cc\u7684\u6587\u4ef6\u540d",id:"headers\u62ff\u4e0d\u5230\u5b8c\u6574\u62ffheaders\u91cc\u7684\u6587\u4ef6\u540d",level:3},{value:"blob \u4e0b\u8f7d\u4e8c\u8fdb\u5236\u6587\u4ef6\u6d41",id:"blob-\u4e0b\u8f7d\u4e8c\u8fdb\u5236\u6587\u4ef6\u6d41",level:3}],d={toc:c};function p(n){let{components:e,...t}=n;return(0,o.kt)("wrapper",(0,r.Z)({},d,t,{components:e,mdxType:"MDXLayout"}),(0,o.kt)("h3",{id:"dom\u8f6cpdf\u4e0b\u8f7d"},"dom\u8f6cpdf\u4e0b\u8f7d"),(0,o.kt)("p",null,"\u7b2c\u4e00\u4e2a\u5c06\u9875\u9762html\u8f6c\u6362\u6210\u56fe\u7247"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"npm install html2canvas --save\n")),(0,o.kt)("p",null,"\u7b2c\u4e8c\u4e2a\u5c06\u56fe\u7247\u751f\u6210pdf"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"npm install jspdf --save\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// toPDF.js\nimport html2canvas from 'html2canvas'\nimport JsPDF from 'jspdf'\n\n/**\n * @param  ele          \u8981\u751f\u6210 pdf \u7684DOM\u5143\u7d20\uff08\u5bb9\u5668\uff09\n * @param  padfName     PDF\u6587\u4ef6\u751f\u6210\u540e\u7684\u6587\u4ef6\u540d\u5b57\n * */\nfunction downloadPDF (ele, pdfName) {\n  document.documentElement.scrollTop = 0\n  html2canvas(ele, {\n    dpi: 300,\n    useCORS: true  // \u5141\u8bb8canvas\u753b\u5e03\u5185 \u53ef\u4ee5\u8de8\u57df\u8bf7\u6c42\u5916\u90e8\u94fe\u63a5\u56fe\u7247, \u5141\u8bb8\u8de8\u57df\u8bf7\u6c42\u3002\n  }).then((canvas) => {\n    const contentWidth = canvas.width\n    const contentHeight = canvas.height\n    // \u4e00\u9875pdf\u663e\u793ahtml\u9875\u9762\u751f\u6210\u7684canvas\u9ad8\u5ea6;\n    const pageHeight = contentWidth / 592.28 * 841.89\n    // \u672a\u751f\u6210pdf\u7684html\u9875\u9762\u9ad8\u5ea6\n    let leftHeight = contentHeight\n    // \u9875\u9762\u504f\u79fb\n    let position = 0\n    // a4\u7eb8\u7684\u5c3a\u5bf8[595.28,841.89]\uff0chtml\u9875\u9762\u751f\u6210\u7684canvas\u5728pdf\u4e2d\u56fe\u7247\u7684\u5bbd\u9ad8\n    const imgWidth = 595.28\n    const imgHeight = 595.28 / contentWidth * contentHeight\n    const pageData = canvas.toDataURL('image/jpeg', 1.0)\n    const pdf = new JsPDF('', 'pt', 'a4')\n    // \u6709\u4e24\u4e2a\u9ad8\u5ea6\u9700\u8981\u533a\u5206\uff0c\u4e00\u4e2a\u662fhtml\u9875\u9762\u7684\u5b9e\u9645\u9ad8\u5ea6\uff0c\u548c\u751f\u6210pdf\u7684\u9875\u9762\u9ad8\u5ea6(841.89)\n    // \u5f53\u5185\u5bb9\u672a\u8d85\u8fc7pdf\u4e00\u9875\u663e\u793a\u7684\u8303\u56f4\uff0c\u65e0\u9700\u5206\u9875\n    if (leftHeight < pageHeight) {\n      // \u5728pdf.addImage(pageData, 'JPEG', \u5de6\uff0c\u4e0a\uff0c\u5bbd\u5ea6\uff0c\u9ad8\u5ea6)\u8bbe\u7f6e\u5728pdf\u4e2d\u663e\u793a\uff1b\n      pdf.addImage(pageData, 'JPEG', 0, 0, imgWidth, imgHeight)\n    } else {    // \u5206\u9875\n      while (leftHeight > 0) {\n        pdf.addImage(pageData, 'JPEG', 0, position, imgWidth, imgHeight)\n        leftHeight -= pageHeight\n        position -= 841.89\n        // \u907f\u514d\u6dfb\u52a0\u7a7a\u767d\u9875\n        if (leftHeight > 0) {\n          pdf.addPage()\n        }\n      }\n    }\n    // \u53ef\u52a8\u6001\u751f\u6210\n    pdf.save(pdfName)\n  })\n}\n\nexport default {\n  downloadPDF\n}\n\n")),(0,o.kt)("p",null,"\u4f7f\u7528toPDF.js"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'import htmlToPdf from "@/assets/js/htmlToPdf"\n\nhtmlToPdf.downloadPDF(\n  document.querySelector("#myexport"), // \u9700\u8981\u8f6c\u5316\u7684dom\n  "\u4e0b\u8f7d\u6587\u4ef6\u7684\u6587\u4ef6\u540d"\n)\n')),(0,o.kt)("p",null,"\u591a\u9009\u62e9\u6846\uff0c\u7531\u968f\u540eid\u8ba1\u7b97\u51faid\u8def\u5f84\u6570\u7ec4\u3002 \u4e0d\u7528\u8bb0\u5f55parentId\u7684\u65b9\u6cd5"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const categoryId = '111'\nconst category = [\n  {\n    id: '1',\n    children: [\n      {\n        id: '11',\n        children: [\n          {\n            id: '111',\n          },\n          {\n            id: '112',\n          },\n          {\n            id: '113',\n          },\n        ]\n      },\n      {\n        id: '12',\n        children: [\n          {\n            id: '121',\n          },\n          {\n            id: '122',\n          },\n          {\n            id: '123',\n          },\n        ]\n      }\n    ]\n  },\n  {\n    id: '2',\n    children: [\n      {\n        id: '21',\n        children: [\n          {\n            id: '211',\n          },\n          {\n            id: '212',\n          },\n          {\n            id: '213',\n          },\n        ]\n      },\n      {\n        id: '22',\n        children: [\n          {\n            id: '221',\n          },\n          {\n            id: '222',\n          },\n          {\n            id: '223',\n          },\n        ]\n      }\n    ]\n  }\n]\n\nconst getIdArr = (categoryList, id) => {\n  let r= [];\n  for (let i = 0; i < categoryList.length; i += 1) {\n    if (categoryList[i].id === id) {\n      r = [categoryList[i].id];\n      break;\n    }\n    const children = categoryList[i]?.children ?? [];\n    for (let j = 0; j < children.length; j += 1) {\n      if (children[j].id === id) {\n        r = [categoryList[i].id, children[j]?.id];\n        break;\n      }\n      const children2 = children[j]?.children ?? [];\n\n      for (let k = 0; k < children2.length; k += 1) {\n        if (children2[k].id === id) {\n          console.log('\u6210\u529f');\n          r = [categoryList[i].id, children[j]?.id, children2[k]?.id];\n          break;\n        }\n      }\n    }\n  }\n  return r;\n};\nconst getIdArr2 = (categoryList, id) => {\n  let r = [];\n  const fn = (\n    list,\n    idInner\n  ) => {\n    for (let i = 0; i < list.length; i += 1) {\n      if (list[i].id === idInner) {\n        return {\n          b: true,\n          r: [list[i].id],\n        };\n      }\n      const children = list[i]?.children ?? [];\n      if (children.length > 0) {\n        const inner = fn(children, idInner);\n        console.log('inner', inner);\n        if (inner.b === true) {\n          return { b: true, r: [list[i].id, ...inner.r] };\n        } else {\n          if (i === list.length - 1) {\n            return { b: false, r: [] };\n          }\n        }\n      } else {\n        if (i === list.length - 1) {\n          return {\n            b: false,\n            r: [],\n          };\n        }\n      }\n    }\n    return { b: false, r: [] };\n  };\n\n  const rObj = fn(categoryList, id);\n  if (rObj.b === true) {\n    r = [...rObj.r];\n  }\n  return r;\n};\n\nconsole.log(\n  'getIdArr2------------',\n\n  category,\n  categoryId,\n  getIdArr2(category, categoryId),\n  getIdArr(category, categoryId),\n);\n")),(0,o.kt)("h3",{id:"headers\u62ff\u4e0d\u5230\u5b8c\u6574\u62ffheaders\u91cc\u7684\u6587\u4ef6\u540d"},"headers\u62ff\u4e0d\u5230\u5b8c\u6574,\u62ffheaders\u91cc\u7684\u6587\u4ef6\u540d"),(0,o.kt)("p",null,"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u53ea\u6709\u4e03\u79cd simple response headers\uff08\u7b80\u5355\u54cd\u5e94\u9996\u90e8\uff09\u53ef\u4ee5\u66b4\u9732\u7ed9\u5916\u90e8\uff1a(\u6d4f\u89c8\u5668\u8c03\u8bd5\u754c\u9762\u53ef\u4ee5\u770b\u5230\u5168\u90e8header\uff0c\u4f46\u662fjs\u53ea\u80fd\u83b7\u5f97\u9ed8\u8ba47\u79cd)"),(0,o.kt)("p",null,"\u5982\u679c\u60f3\u8981\u8ba9\u5ba2\u6237\u7aef\u53ef\u4ee5\u8bbf\u95ee\u5230\u5176\u4ed6\u7684\u9996\u90e8\u4fe1\u606f\uff0c\u53ef\u4ee5\u5c06\u5b83\u4eec\u5728 Access-Control-Expose-Headers \u91cc\u9762\u5217\u51fa\u6765\u3002(\u540e\u7aef\u9700\u8981\u5728response\u7684\u5934\u91cc\u9762\u52a0)"),(0,o.kt)("p",null,"Access-Control-Expose-Headers: ",(0,o.kt)("inlineCode",{parentName:"p"},"<header-name>"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"<header-name>"),", ..."),(0,o.kt)("p",null,"\u89c1",(0,o.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Expose-Headers"},"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Expose-Headers")),(0,o.kt)("h3",{id:"blob-\u4e0b\u8f7d\u4e8c\u8fdb\u5236\u6587\u4ef6\u6d41"},"blob \u4e0b\u8f7d\u4e8c\u8fdb\u5236\u6587\u4ef6\u6d41"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"// umirequest \u4e2d\u5199\u6cd5,axios\u4e2dheader\u83b7\u53d6\u65b9\u5f0f\u4e0d\u540c\n\n// \u5220\u9664url\u53c2\u6570 // \u5982\u679c\u662fvue\uff0cvue route\u91cc\u9762\u6709\u76f4\u63a5\u53ef\u4ee5\u7528\u7684\u65b9\u6cd5\nexport const urlDelParameter = (key: string | string[], href: string) => {\n  // const { href } = window.location;\n  const query = qs.parse(href?.split('?')[1]);\n  if (typeof key === 'object' && key?.forEach) {\n    key.forEach((val) => {\n      delete query[val];\n    });\n  } else if (typeof key === 'string') {\n    delete query[key];\n  }\n  return qs.stringify(query);\n};\n/** \u54cd\u5e94\u62e6\u622a\u5668 */\nasync function responseInterceptor(response: any) {\n  if (response?.status === API_CODES.SUCCESS) {\n    try {\n      const data = await response.clone().json();\n\n      // 4001 token\u5931\u6548\n      if (data?.code === API_Data_CODES.TOKEN_ERROR) {\n\n        window.localStorage.removeItem('token');\n        const res = await refreshTokenUsingPOST({ refreshToken: getRToken() as string });\n        if (res?.data?.token && res?.data?.rtoken) {\n          setToken(res.data.token);\n          setRToken(res.data.rtoken);\n          window.location.reload();\n        }\n      } else if (data?.code === API_Data_CODES.R_TOKEN_ERROR) {\n        // 4002 refresh token\u5931\u6548\n        window.localStorage.removeItem('token');\n        window.localStorage.removeItem('rToken');\n        const formatSearch = urlDelParameter( // \u5220\u9664url\u53c2\u6570\n          ['token', 'rtoken', 'lang', 'type', 'employeeNo'],\n          decodeURIComponent(window.location.href),\n        );\n        // console.log('formatSearch',formatSearch)\n        const loginUrl = `${getPrefixUrl('loginUrl')}//#/c-login?redirect=${encodeURIComponent(\n          `${getPrefixUrl('redirect')}${window.location.pathname}${\n            formatSearch ? `?${formatSearch}` : ''\n          }`,\n        )}`;\n        // console.log('loginUrl',loginUrl)\n\n        window.location.href = loginUrl;\n        // history.push('/user/login');\n      } else {\n        if (data?.code !== API_Data_CODES.SUCCESS) {\n          message.error(data.msg);\n        }\n      }\n      return response;\n    } catch (e) {\n      let fn = async () => {\n        const blobO = await response.blob();\n        if (blobO instanceof Blob) {\n          // \u83b7\u53d6excel \u5bfc\u51fa\u540d\u79f0\n          const name =\n            response.headers.get('Content-disposition')?.split('filename=')[1] ?? '\u4e0b\u8f7d\u6587\u4ef6';\n          /** \u4e0b\u8f7d\u6587\u4ef6-\u8bf7\u6c42\u540e\u5904\u7406\u51fd\u6570 */\n          exportFileCallback(blobO, name);\n        }\n        return response;\n      };\n      fn();\n    }\n  } else {\n    message.error('network has some problem');\n    return Promise.reject(response);\n  }\n}\n\nfunction exportFileCallback(res: any, filename: string) {\nconsole.log('type', res.type);\nconst blob = new Blob([res], { type: res.type });\n// const blob = new Blob([res.Blob], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });\n\nconst a = document.createElement('a');\nconst URL = window.URL || window.webkitURL;\n// const herf = window.URL.createObjectURL(res)\nconst herf = URL.createObjectURL(blob);\na.href = herf;\na.download = filename;\ndocument.body.appendChild(a);\na.click();\ndocument.body.removeChild(a);\nwindow.URL.revokeObjectURL(herf);\n}\n")),(0,o.kt)("p",null,"\u5b57\u7b26\u4e32\u66ff\u6362"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'\n// str.replace("\u9700\u8981\u66ff\u6362\u7684\u5b57\u7b26\u4e32"\uff0c"\u65b0\u5b57\u7b26\u4e32")\u3000\n\n// str.replace(/\u9700\u8981\u66ff\u6362\u7684\u5b57\u7b26\u4e32/g\uff0c"\u65b0\u5b57\u7b26\u4e32")\n\n// \u5c06linux\u7684/ \u6362\u6210 win\u7684\\ \u529f\u80fd\u51fd\u6570\uff0c\u6b63\u5219\u4e2d\\\u7528\u6765\u8f6c\u4e49\uff0c\u5b57\u7b26\u4e32\u4e2d\\\u9700\u8981\u7528\\\u6765\u8f6c\u4e49\nconst replaceForWin = (val)=> {\nreturn val?.replace(/\\//g, \'\\\\\') ?? \'\'\n}\n')))}p.isMDXComponent=!0}}]);