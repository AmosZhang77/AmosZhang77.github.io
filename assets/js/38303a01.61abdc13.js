"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2850],{3905:(n,e,t)=>{t.d(e,{Zo:()=>p,kt:()=>u});var r=t(7294);function o(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function a(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function l(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?a(Object(t),!0).forEach((function(e){o(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function i(n,e){if(null==n)return{};var t,r,o=function(n,e){if(null==n)return{};var t,r,o={},a=Object.keys(n);for(r=0;r<a.length;r++)t=a[r],e.indexOf(t)>=0||(o[t]=n[t]);return o}(n,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);for(r=0;r<a.length;r++)t=a[r],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(o[t]=n[t])}return o}var s=r.createContext({}),c=function(n){var e=r.useContext(s),t=e;return n&&(t="function"==typeof n?n(e):l(l({},e),n)),t},p=function(n){var e=c(n.components);return r.createElement(s.Provider,{value:e},n.children)},d={inlineCode:"code",wrapper:function(n){var e=n.children;return r.createElement(r.Fragment,{},e)}},m=r.forwardRef((function(n,e){var t=n.components,o=n.mdxType,a=n.originalType,s=n.parentName,p=i(n,["components","mdxType","originalType","parentName"]),m=c(t),u=o,f=m["".concat(s,".").concat(u)]||m[u]||d[u]||a;return t?r.createElement(f,l(l({ref:e},p),{},{components:t})):r.createElement(f,l({ref:e},p))}));function u(n,e){var t=arguments,o=e&&e.mdxType;if("string"==typeof n||o){var a=t.length,l=new Array(a);l[0]=m;var i={};for(var s in e)hasOwnProperty.call(e,s)&&(i[s]=e[s]);i.originalType=n,i.mdxType="string"==typeof n?n:o,l[1]=i;for(var c=2;c<a;c++)l[c]=t[c];return r.createElement.apply(null,l)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},5901:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>s,contentTitle:()=>l,default:()=>d,frontMatter:()=>a,metadata:()=>i,toc:()=>c});var r=t(7462),o=(t(7294),t(3905));const a={},l=void 0,i={unversionedId:"js/function_collection/function_collection",id:"js/function_collection/function_collection",title:"function_collection",description:"dom \u8f6c pdf \u4e0b\u8f7d",source:"@site/docs/js/function_collection/function_collection.mdx",sourceDirName:"js/function_collection",slug:"/js/function_collection/",permalink:"/docs/js/function_collection/",draft:!1,tags:[],version:"current",lastUpdatedAt:1706087011,formattedLastUpdatedAt:"2024\u5e741\u670824\u65e5",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"flow",permalink:"/docs/js/flow/"},next:{title:"date",permalink:"/docs/js/function_collection/date/"}},s={},c=[{value:"dom \u8f6c pdf \u4e0b\u8f7d",id:"dom-\u8f6c-pdf-\u4e0b\u8f7d",level:3},{value:"headers \u62ff\u4e0d\u5230\u5b8c\u6574,\u62ff headers \u91cc\u7684\u6587\u4ef6\u540d",id:"headers-\u62ff\u4e0d\u5230\u5b8c\u6574\u62ff-headers-\u91cc\u7684\u6587\u4ef6\u540d",level:3},{value:"blob \u4e0b\u8f7d\u4e8c\u8fdb\u5236\u6587\u4ef6\u6d41",id:"blob-\u4e0b\u8f7d\u4e8c\u8fdb\u5236\u6587\u4ef6\u6d41",level:3},{value:"\u6bd4\u8f83\u7f51\u901f\uff0c\u9009\u62e9\u5feb\u7684\u7f51\u5740\u4f5c\u4e3a\u7cfb\u7edf api \u5730\u5740",id:"\u6bd4\u8f83\u7f51\u901f\u9009\u62e9\u5feb\u7684\u7f51\u5740\u4f5c\u4e3a\u7cfb\u7edf-api-\u5730\u5740",level:3},{value:"\u5c3e\u9012\u5f52",id:"\u5c3e\u9012\u5f52",level:3},{value:"\u9632\u6296",id:"\u9632\u6296",level:3},{value:"\u8282\u6d41",id:"\u8282\u6d41",level:3}],p={toc:c};function d(n){let{components:e,...t}=n;return(0,o.kt)("wrapper",(0,r.Z)({},p,t,{components:e,mdxType:"MDXLayout"}),(0,o.kt)("h3",{id:"dom-\u8f6c-pdf-\u4e0b\u8f7d"},"dom \u8f6c pdf \u4e0b\u8f7d"),(0,o.kt)("p",null,"\u7b2c\u4e00\u4e2a\u5c06\u9875\u9762 html \u8f6c\u6362\u6210\u56fe\u7247"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"npm install html2canvas --save\n")),(0,o.kt)("p",null,"\u7b2c\u4e8c\u4e2a\u5c06\u56fe\u7247\u751f\u6210 pdf"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"npm install jspdf --save\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'// toPDF.js\nimport html2canvas from "html2canvas";\nimport JsPDF from "jspdf";\n\n/**\n * @param  ele          \u8981\u751f\u6210 pdf \u7684DOM\u5143\u7d20\uff08\u5bb9\u5668\uff09\n * @param  padfName     PDF\u6587\u4ef6\u751f\u6210\u540e\u7684\u6587\u4ef6\u540d\u5b57\n * */\nfunction downloadPDF(ele, pdfName) {\n  document.documentElement.scrollTop = 0;\n  html2canvas(ele, {\n    dpi: 300,\n    useCORS: true, // \u5141\u8bb8canvas\u753b\u5e03\u5185 \u53ef\u4ee5\u8de8\u57df\u8bf7\u6c42\u5916\u90e8\u94fe\u63a5\u56fe\u7247, \u5141\u8bb8\u8de8\u57df\u8bf7\u6c42\u3002\n  }).then((canvas) => {\n    const contentWidth = canvas.width;\n    const contentHeight = canvas.height;\n    // \u4e00\u9875pdf\u663e\u793ahtml\u9875\u9762\u751f\u6210\u7684canvas\u9ad8\u5ea6;\n    const pageHeight = (contentWidth / 592.28) * 841.89;\n    // \u672a\u751f\u6210pdf\u7684html\u9875\u9762\u9ad8\u5ea6\n    let leftHeight = contentHeight;\n    // \u9875\u9762\u504f\u79fb\n    let position = 0;\n    // a4\u7eb8\u7684\u5c3a\u5bf8[595.28,841.89]\uff0chtml\u9875\u9762\u751f\u6210\u7684canvas\u5728pdf\u4e2d\u56fe\u7247\u7684\u5bbd\u9ad8\n    const imgWidth = 595.28;\n    const imgHeight = (595.28 / contentWidth) * contentHeight;\n    const pageData = canvas.toDataURL("image/jpeg", 1.0);\n    const pdf = new JsPDF("", "pt", "a4");\n    // \u6709\u4e24\u4e2a\u9ad8\u5ea6\u9700\u8981\u533a\u5206\uff0c\u4e00\u4e2a\u662fhtml\u9875\u9762\u7684\u5b9e\u9645\u9ad8\u5ea6\uff0c\u548c\u751f\u6210pdf\u7684\u9875\u9762\u9ad8\u5ea6(841.89)\n    // \u5f53\u5185\u5bb9\u672a\u8d85\u8fc7pdf\u4e00\u9875\u663e\u793a\u7684\u8303\u56f4\uff0c\u65e0\u9700\u5206\u9875\n    if (leftHeight < pageHeight) {\n      // \u5728pdf.addImage(pageData, \'JPEG\', \u5de6\uff0c\u4e0a\uff0c\u5bbd\u5ea6\uff0c\u9ad8\u5ea6)\u8bbe\u7f6e\u5728pdf\u4e2d\u663e\u793a\uff1b\n      pdf.addImage(pageData, "JPEG", 0, 0, imgWidth, imgHeight);\n    } else {\n      // \u5206\u9875\n      while (leftHeight > 0) {\n        pdf.addImage(pageData, "JPEG", 0, position, imgWidth, imgHeight);\n        leftHeight -= pageHeight;\n        position -= 841.89;\n        // \u907f\u514d\u6dfb\u52a0\u7a7a\u767d\u9875\n        if (leftHeight > 0) {\n          pdf.addPage();\n        }\n      }\n    }\n    // \u53ef\u52a8\u6001\u751f\u6210\n    pdf.save(pdfName);\n  });\n}\n\nexport default {\n  downloadPDF,\n};\n')),(0,o.kt)("p",null,"\u4f7f\u7528 toPDF.js"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'import htmlToPdf from "@/assets/js/htmlToPdf";\n\nhtmlToPdf.downloadPDF(\n  document.querySelector("#myexport"), // \u9700\u8981\u8f6c\u5316\u7684dom\n  "\u4e0b\u8f7d\u6587\u4ef6\u7684\u6587\u4ef6\u540d"\n);\n')),(0,o.kt)("p",null,"\u591a\u9009\u62e9\u6846\uff0c\u7531\u968f\u540e id \u8ba1\u7b97\u51fa id \u8def\u5f84\u6570\u7ec4\u3002 \u4e0d\u7528\u8bb0\u5f55 parentId \u7684\u65b9\u6cd5"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const categoryId = "111";\nconst category = [\n  {\n    id: "1",\n    children: [\n      {\n        id: "11",\n        children: [\n          {\n            id: "111",\n          },\n          {\n            id: "112",\n          },\n          {\n            id: "113",\n          },\n        ],\n      },\n      {\n        id: "12",\n        children: [\n          {\n            id: "121",\n          },\n          {\n            id: "122",\n          },\n          {\n            id: "123",\n          },\n        ],\n      },\n    ],\n  },\n  {\n    id: "2",\n    children: [\n      {\n        id: "21",\n        children: [\n          {\n            id: "211",\n          },\n          {\n            id: "212",\n          },\n          {\n            id: "213",\n          },\n        ],\n      },\n      {\n        id: "22",\n        children: [\n          {\n            id: "221",\n          },\n          {\n            id: "222",\n          },\n          {\n            id: "223",\n          },\n        ],\n      },\n    ],\n  },\n];\n\nconst getIdArr = (categoryList, id) => {\n  let r = [];\n  for (let i = 0; i < categoryList.length; i += 1) {\n    if (categoryList[i].id === id) {\n      r = [categoryList[i].id];\n      break;\n    }\n    const children = categoryList[i]?.children ?? [];\n    for (let j = 0; j < children.length; j += 1) {\n      if (children[j].id === id) {\n        r = [categoryList[i].id, children[j]?.id];\n        break;\n      }\n      const children2 = children[j]?.children ?? [];\n\n      for (let k = 0; k < children2.length; k += 1) {\n        if (children2[k].id === id) {\n          console.log("\u6210\u529f");\n          r = [categoryList[i].id, children[j]?.id, children2[k]?.id];\n          break;\n        }\n      }\n    }\n  }\n  return r;\n};\nconst getIdArr2 = (categoryList, id) => {\n  let r = [];\n  const fn = (list, idInner) => {\n    for (let i = 0; i < list.length; i += 1) {\n      if (list[i].id === idInner) {\n        return {\n          b: true,\n          r: [list[i].id],\n        };\n      }\n      const children = list[i]?.children ?? [];\n      if (children.length > 0) {\n        const inner = fn(children, idInner);\n        console.log("inner", inner);\n        if (inner.b === true) {\n          return { b: true, r: [list[i].id, ...inner.r] };\n        } else {\n          if (i === list.length - 1) {\n            return { b: false, r: [] };\n          }\n        }\n      } else {\n        if (i === list.length - 1) {\n          return {\n            b: false,\n            r: [],\n          };\n        }\n      }\n    }\n    return { b: false, r: [] };\n  };\n\n  const rObj = fn(categoryList, id);\n  if (rObj.b === true) {\n    r = [...rObj.r];\n  }\n  return r;\n};\n\nconsole.log(\n  "getIdArr2------------",\n\n  category,\n  categoryId,\n  getIdArr2(category, categoryId),\n  getIdArr(category, categoryId)\n);\n')),(0,o.kt)("h3",{id:"headers-\u62ff\u4e0d\u5230\u5b8c\u6574\u62ff-headers-\u91cc\u7684\u6587\u4ef6\u540d"},"headers \u62ff\u4e0d\u5230\u5b8c\u6574,\u62ff headers \u91cc\u7684\u6587\u4ef6\u540d"),(0,o.kt)("p",null,"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u53ea\u6709\u4e03\u79cd simple response headers\uff08\u7b80\u5355\u54cd\u5e94\u9996\u90e8\uff09\u53ef\u4ee5\u66b4\u9732\u7ed9\u5916\u90e8\uff1a(\u6d4f\u89c8\u5668\u8c03\u8bd5\u754c\u9762\u53ef\u4ee5\u770b\u5230\u5168\u90e8 header\uff0c\u4f46\u662f js \u53ea\u80fd\u83b7\u5f97\u9ed8\u8ba4 7 \u79cd)"),(0,o.kt)("p",null,"\u5982\u679c\u60f3\u8981\u8ba9\u5ba2\u6237\u7aef\u53ef\u4ee5\u8bbf\u95ee\u5230\u5176\u4ed6\u7684\u9996\u90e8\u4fe1\u606f\uff0c\u53ef\u4ee5\u5c06\u5b83\u4eec\u5728 Access-Control-Expose-Headers \u91cc\u9762\u5217\u51fa\u6765\u3002(\u540e\u7aef\u9700\u8981\u5728 response \u7684\u5934\u91cc\u9762\u52a0)"),(0,o.kt)("p",null,"Access-Control-Expose-Headers: ",(0,o.kt)("inlineCode",{parentName:"p"},"<header-name>"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"<header-name>"),", ..."),(0,o.kt)("p",null,"\u89c1",(0,o.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Expose-Headers"},"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Expose-Headers")),(0,o.kt)("h3",{id:"blob-\u4e0b\u8f7d\u4e8c\u8fdb\u5236\u6587\u4ef6\u6d41"},"blob \u4e0b\u8f7d\u4e8c\u8fdb\u5236\u6587\u4ef6\u6d41"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},'// umirequest \u4e2d\u5199\u6cd5,axios\u4e2dheader\u83b7\u53d6\u65b9\u5f0f\u4e0d\u540c\n\n// \u5220\u9664url\u53c2\u6570 // \u5982\u679c\u662fvue\uff0cvue route\u91cc\u9762\u6709\u76f4\u63a5\u53ef\u4ee5\u7528\u7684\u65b9\u6cd5\nexport const urlDelParameter = (key: string | string[], href: string) => {\n  // const { href } = window.location;\n  const query = qs.parse(href?.split("?")[1]);\n  if (typeof key === "object" && key?.forEach) {\n    key.forEach((val) => {\n      delete query[val];\n    });\n  } else if (typeof key === "string") {\n    delete query[key];\n  }\n  return qs.stringify(query);\n};\n/** \u54cd\u5e94\u62e6\u622a\u5668 */\nasync function responseInterceptor(response: any) {\n  if (response?.status === API_CODES.SUCCESS) {\n    try {\n      const data = await response.clone().json();\n\n      // 4001 token\u5931\u6548\n      if (data?.code === API_Data_CODES.TOKEN_ERROR) {\n        window.localStorage.removeItem("token");\n        const res = await refreshTokenUsingPOST({\n          refreshToken: getRToken() as string,\n        });\n        if (res?.data?.token && res?.data?.rtoken) {\n          setToken(res.data.token);\n          setRToken(res.data.rtoken);\n          window.location.reload();\n        }\n      } else if (data?.code === API_Data_CODES.R_TOKEN_ERROR) {\n        // 4002 refresh token\u5931\u6548\n        window.localStorage.removeItem("token");\n        window.localStorage.removeItem("rToken");\n        const formatSearch = urlDelParameter(\n          // \u5220\u9664url\u53c2\u6570\n          ["token", "rtoken", "lang", "type", "employeeNo"],\n          decodeURIComponent(window.location.href)\n        );\n        // console.log(\'formatSearch\',formatSearch)\n        const loginUrl = `${getPrefixUrl(\n          "loginUrl"\n        )}//#/c-login?redirect=${encodeURIComponent(\n          `${getPrefixUrl("redirect")}${window.location.pathname}${\n            formatSearch ? `?${formatSearch}` : ""\n          }`\n        )}`;\n        // console.log(\'loginUrl\',loginUrl)\n\n        window.location.href = loginUrl;\n        // history.push(\'/user/login\');\n      } else {\n        if (data?.code !== API_Data_CODES.SUCCESS) {\n          message.error(data.msg);\n        }\n      }\n      return response;\n    } catch (e) {\n      let fn = async () => {\n        const blobO = await response.blob();\n        if (blobO instanceof Blob) {\n          // \u83b7\u53d6excel \u5bfc\u51fa\u540d\u79f0 axios\u4e2d\u4f7f\u7528\n          const contentDisposition = res.headers["content-disposition"];\n          const type = res.headers["content-Type"];\n          let fileName;\n          if (contentDisposition.indexOf("filename*=utf-8\'\'") !== -1) {\n            fileName = decodeURIComponent(\n              contentDisposition.split("filename*=utf-8\'\'")[1]\n            );\n          } else {\n            fileName = decodeURIComponent(\n              contentDisposition.split("filename=")[1]\n            );\n          }\n\n          // \u83b7\u53d6excel \u5bfc\u51fa\u540d\u79f0 umi\u4e2d\u4f7f\u7528\n          const name =\n            response.headers\n              .get("Content-disposition")\n              ?.split("filename=")[1] ?? "\u4e0b\u8f7d\u6587\u4ef6";\n          /** \u4e0b\u8f7d\u6587\u4ef6-\u8bf7\u6c42\u540e\u5904\u7406\u51fd\u6570 */\n          exportFileCallback(blobO, name);\n          console.log("type", res.type);\n          const blob = new Blob([res], { type: res.type });\n          // const blob = new Blob([res.Blob], { type: \'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\' });\n\n          const a = document.createElement("a");\n          const URL = window.URL || window.webkitURL;\n          // const herf = window.URL.createObjectURL(res)\n          const herf = URL.createObjectURL(blob);\n          a.href = herf;\n          a.download = filename;\n          document.body.appendChild(a);\n          a.click();\n          document.body.removeChild(a);\n          window.URL.revokeObjectURL(herf);\n        }\n        return response;\n      };\n      fn();\n    }\n  } else {\n    message.error("network has some problem");\n    return Promise.reject(response);\n  }\n}\n\nfunction exportFileCallback(res: any, filename: string) {\n  console.log("type", res.type);\n  const blob = new Blob([res], { type: res.type });\n  // const blob = new Blob([res.Blob], { type: \'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\' });\n\n  const a = document.createElement("a");\n  const URL = window.URL || window.webkitURL;\n  // const herf = window.URL.createObjectURL(res)\n  const herf = URL.createObjectURL(blob);\n  a.href = herf;\n  a.download = filename;\n  document.body.appendChild(a);\n  a.click();\n  document.body.removeChild(a);\n  window.URL.revokeObjectURL(herf);\n}\n\nfunction exportFileCallback(res: any, filename: string) {\n  console.log("type", res.type);\n  const blob = new Blob([res], { type: res.type });\n  // const blob = new Blob([res.Blob], { type: \'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\' });\n\n  const a = document.createElement("a");\n  const URL = window.URL || window.webkitURL;\n  // const herf = window.URL.createObjectURL(res)\n  const herf = URL.createObjectURL(blob);\n  a.href = herf;\n  a.download = filename;\n  document.body.appendChild(a);\n  a.click();\n  document.body.removeChild(a);\n  window.URL.revokeObjectURL(herf);\n}\n')),(0,o.kt)("p",null,"\u5b57\u7b26\u4e32\u66ff\u6362"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'// str.replace("\u9700\u8981\u66ff\u6362\u7684\u5b57\u7b26\u4e32"\uff0c"\u65b0\u5b57\u7b26\u4e32")\n\n// str.replace(/\u9700\u8981\u66ff\u6362\u7684\u5b57\u7b26\u4e32/g\uff0c"\u65b0\u5b57\u7b26\u4e32")\n\n// \u5c06linux\u7684/ \u6362\u6210 win\u7684\\ \u529f\u80fd\u51fd\u6570\uff0c\u6b63\u5219\u4e2d\\\u7528\u6765\u8f6c\u4e49\uff0c\u5b57\u7b26\u4e32\u4e2d\\\u9700\u8981\u7528\\\u6765\u8f6c\u4e49\nconst replaceForWin = (val) => {\n  return val?.replace(/\\//g, "\\\\") ?? "";\n};\n')),(0,o.kt)("h3",{id:"\u6bd4\u8f83\u7f51\u901f\u9009\u62e9\u5feb\u7684\u7f51\u5740\u4f5c\u4e3a\u7cfb\u7edf-api-\u5730\u5740"},"\u6bd4\u8f83\u7f51\u901f\uff0c\u9009\u62e9\u5feb\u7684\u7f51\u5740\u4f5c\u4e3a\u7cfb\u7edf api \u5730\u5740"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},'// \u8fd9\u91cc\u52a0setTimeout\u7684\u539f\u56e0\uff1aapp \u91cc\u9762\u53ea\u8981\u5199promise\u6216\u8005await\uff0cconsole\u662f\u6b63\u786e\u7684\u7f51\u5740\uff0c\u4f46\u662f\u5b9e\u9645\u8fd0\u884c\u62ff\u4e0d\u5230\uff0c\n// \u653e\u5230setTimeout\u91cc\u9762\u5c31\u53ef\u4ee5\uff08\u8fd9\u91cc\u4e0d\u77e5\u9053umi\u6846\u67b6\u4ea7\u751f\u8fd9\u4e2a\u95ee\u9898\u7684\u539f\u56e0\uff09\nsetTimeout(async () => {\n  async function hello1() {\n    // \u8fd9\u91cc\u56e0\u4e3a\u5168\u5c40\u63a5\u53e3\u548c\u7f51\u901f\u6d4b\u8bd5\u63a5\u53e3\u5730\u5740\u4e0d\u540c\uff08\u5dee\u4e00\u4e2aapi\uff09\uff0c\n    // \u6240\u4ee5\u7528umi\u7684request\u8bf7\u6c42\u7f51\u901f\u63a5\u53e3\uff0c\u4f1a\u88abumi\u6574\u4f53\u8bbe\u7f6e\u7684\u524d\u7f00url\u5f71\u54cd\u800c\u591a\u4e00\u4e2aapi\u53bb\u4e0d\u6389\uff0c\u6240\u4ee5\u8fd9\u91cc\u7528fetch\n    // \u6d4b\u901fapi\n    await fetch("https://hkapi.com/test/hello", {\n      method: "GET",\n    });\n    // \u56e0\u4e3aPromise.race\u65e0\u6cd5\u5f97\u5230\u662f\u54ea\u4e2aapi\u5feb\uff0c\u53ea\u6709\u5148\u5230\u7684api\u7684\u7ed3\u679c\uff0c\n    // \u540e\u7aef\u6d4b\u901f\u63a5\u53e3\u4e0d\u8fd4\u56de\u7684\u60c5\u51b5\u4e0b\uff0c\u9700\u8981\u5c06\u4e24\u4e2a\u8bf7\u6c42\u518d\u5305\u88c5\u4e00\u5c42promise\uff0c\u8fd4\u56de\u4e0d\u540c\u7684\u5185\u5bb9\uff0c\u7528\u4e8e\u533a\u5206\u54ea\u4e2a\u7f51\u5740\u6bd4\u8f83\u5feb\u3002\n    // \u8fd9\u91cc hello1,hello2\u5c31\u662f\u5c01\u88c5\uff0c\u8fd4\u56de\u4e0d\u540c\u7684\u7ed3\u679c\uff0c\u7528\u4ee5race\u540e\u5224\u65ad\u54ea\u4e2a\u5148\u8fd4\u56de\n    return Promise.resolve("https://hkapi.com/api");\n  }\n  async function hello2() {\n    await fetch("https://cnapi.com/test/hello", {\n      method: "GET",\n    });\n    return Promise.resolve("https://cnapi.com/api");\n  }\n  const getFastestUrl = async () => {\n    const res = await Promise.race([hello1(), hello2()]);\n    localStorage.setItem("fastPublicPath", res);\n  };\n  if (REACT_APP_E === "prod" || REACT_APP_E === "test") {\n    getFastestUrl();\n  }\n}, 1);\n')),(0,o.kt)("p",null,"\u4e0d\u7528 await \u7684\u5199\u6cd5"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},'export const queryFastUrl = () => {\n  const p1 = new Promise((resolve) => {\n    fetch("https://hkapi.com/test/hello", {\n      method: "GET",\n    }).then(() => {\n      resolve("https://hkapi.com/api");\n    });\n  });\n  const p2 = new Promise((resolve) => {\n    fetch("https://cnapi.com/test/hello", {\n      method: "GET",\n    }).then(() => {\n      resolve("https://cnapi.com/api");\n    });\n  });\n  if (REACT_APP_E === "prod" || REACT_APP_E === "test") {\n    Promise.race([p1, p2]).then((e) => {\n      localStorage.setItem("fastPublicPath", e);\n    });\n  }\n};\n')),(0,o.kt)("h3",{id:"\u5c3e\u9012\u5f52"},"\u5c3e\u9012\u5f52"),(0,o.kt)("p",null,"\u9012\u5f52\u4f18\u5316\u7684\u6761\u4ef6\uff1a"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u4ee3\u7801\u5728\u4e25\u683c\u6a21\u5f0f\u4e0b\u6267\u884c"),(0,o.kt)("li",{parentName:"ol"},"\u5916\u90e8\u51fd\u6570\u7684\u8fd4\u56de\u503c\uff0c\u662f\u5bf9\u5c3e\u8c03\u7528\u51fd\u6570\u7684\u8c03\u7528"),(0,o.kt)("li",{parentName:"ol"},"\u5c3e\u8c03\u7528\u51fd\u6570\u8fd4\u56de\u540e\uff0c\u4e0d\u9700\u8981\u6267\u884c\u989d\u5916\u7684\u903b\u8f91"),(0,o.kt)("li",{parentName:"ol"},"\u5c3e\u8c03\u7528\u51fd\u6570\u4e0d\u662f\u5916\u90e8\u51fd\u6570\u4f5c\u7528\u57df\u4e2d\u81ea\u7531\u53d8\u91cf\u7684\u95ed\u5305")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"// \u65e0\u4f18\u5316\uff1a \u5c3e\u8c03\u7528\u6ca1\u6709\u8fd4\u56de\nfunction outer() {\n  inner();\n}\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"// \u65e0\u4f18\u5316\uff1a \u5c3e\u8c03\u7528\u6ca1\u6709\u76f4\u63a5\u8fd4\u56de\nfunction outer() {\n  let innerResult = inner();\n\n  return innerResult;\n}\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"//\u65e0\u4f18\u5316\uff1a \u5c3e\u8c03\u7528\u8fd4\u56de\u503c\u540e\uff0c\u5fc5\u987b\u8981\u8f6c\u578b\u4e3a\u5b57\u7b26\u4e32\nfunction outer() {\n  return inner().toString();\n}\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'// \u65e0\u4f18\u5316\uff1a \u5c3e\u8c03\u7528\u662f\u4e00\u4e2a\u95ed\u5305\nfunction outer() {\n  let foo = "bar";\n\n  function inner() {\n    return foo;\n  }\n\n  return inner();\n}\n')),(0,o.kt)("p",null,"\u4e58\u9636"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"// \u4f18\u5316\u524d\nfunction foo(n) {\n  if (n <= 1) {\n    return 1;\n  }\n  return n * foo(n - 1);\n}\n\nfoo(5); // 120\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"// \u4f18\u5316\u540e\nfunction foo(n) {\n  return inner(n, n - 1);\n}\n\nfunction inner(sum, n) {\n  if (n <= 1) {\n    return sum;\n  }\n  return inner(sum * n, n - 1);\n}\n\nfoo(5);\n")),(0,o.kt)("h3",{id:"\u9632\u6296"},"\u9632\u6296"),(0,o.kt)("p",null,"\u6296\u52a8\u5b8c\u4e86\u4e4b\u540e\uff0c\u6267\u884c\u6700\u540e\u4e00\u6b21"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"function debounce() {\n  let time;\n  return function () {\n    if (time) clearTimeout(time);\n    time = setTimeout(() => {\n      fn.apply(this, arguments);\n      clearTimeout(time);\n    }, delay);\n  };\n}\n")),(0,o.kt)("h3",{id:"\u8282\u6d41"},"\u8282\u6d41"),(0,o.kt)("p",null,"\u5f00\u59cb\u5c31\u6267\u884c\uff0c\u4f46\u662f\u9650\u5236\u6267\u884c\u9891\u7387"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"function throttle(fn, delay = 200) {\n  let time;\n  return function () {\n    if (time) return;\n    fn.apply(this, arguments);\n    time = setTimeout(() => {\n      clearTimeout(time);\n    }, delay);\n  };\n}\n")))}d.isMDXComponent=!0}}]);